<!DOCTYPE html>
<!-- 
    Script.ai - Professional Digital Workspace
    Fixed Issues & Improvements:
    ✅ Removed duplicate CSS scrollbar definitions
    ✅ Fixed Font Awesome to use official CDN
    ✅ Removed unreliable external audio source
    ✅ Replaced inline styles with CSS classes
    ✅ Added comprehensive accessibility features (aria-labels, roles, keyboard navigation)
    ✅ Enhanced focus management and keyboard shortcuts
    ✅ Improved performance with debouncing and optimization
    ✅ Added proper error handling and debugging
    ✅ Enhanced meta tags for better SEO and security
    ✅ Optimized for GitHub Pages deployment
    ✅ Removed HTTPS warnings (GitHub Pages provides HTTPS)
    ✅ Simplified voice recognition setup
    ✅ Professional toolbar alignment and responsive design
    ✅ Enhanced visual hierarchy with glassmorphism effects
    ✅ Fixed element references and state management
    ✅ Enhanced security with textContent instead of innerHTML
    ✅ Improved memory management for file downloads
    ✅ Optimized font loading (removed unnecessary Scheherazade New)
    ✅ Enhanced spell correction performance
    ✅ Better mobile responsiveness
    ✅ Improved error handling and user feedback
    ✅ Added performance monitoring
    ✅ Added dynamic font size control with keyboard shortcuts
    ✅ Professional dropdown-based toolbar with elegant animations
    ✅ Integrated header with professional toolbar and action buttons
    ✅ Enhanced UI design with refined glass-morphism effects and modern styling
    ✅ Complete dropdown redesign with detailed content and professional layout
    ✅ Modern voice recording with professional glassmorphism design and advanced features
    ✅ Smart recording with blank page mode, automatic alignment, timestamps and session summaries
    ✅ Advanced text merge system for combining transcriptions from different sessions
    ✅ Organized recording layout with top-to-bottom transcription flow starting right below session header
    ✅ Dedicated blank paper recording mode - recordings only saved and displayed in blank paper with automatic switching
    ✅ Smart clear functionality - separate clearing for recordings in blank mode vs regular content in other papers
-->
<html lang="ar" dir="auto">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#dbeafe">
    <meta name="color-scheme" content="light">
    <title>Script - Professional Digital Workspace</title>
    <meta name="description" content="Distinguished digital workspace featuring intelligent voice recognition for Arabic and English. Professional note-taking with elegant paper styles and sophisticated voice-to-text capabilities.">
    <meta name="keywords" content="voice recognition, digital workspace, note taking, Arabic, English, voice to text, professional editor">
    <meta name="author" content="Distinguished Developer">
    <meta property="og:title" content="Script - Professional Digital Workspace">
    <meta property="og:description" content="Sophisticated voice-enabled workspace with intelligent language detection">
    <meta property="og:type" content="website">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <!-- Optimized font loading - only essential fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Patrick Hand', cursive;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            margin: 0;
            width: 100%;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(51, 65, 85, 0.05) 0%, transparent 60%),
                radial-gradient(circle at 80% 80%, rgba(30, 58, 138, 0.05) 0%, transparent 60%),
                radial-gradient(circle at 40% 60%, rgba(217, 119, 6, 0.03) 0%, transparent 60%);
            pointer-events: none;
            z-index: -1;
        }
        
        /* Optimized font classes - only essential fonts */
        .font-patrick { font-family: 'Patrick Hand', cursive; }
        .font-arabic { font-family: 'Amiri', serif; }
        .font-ottoman { font-family: 'Amiri', serif; }

        /* Arabic text styling */
        .arabic-text {
            font-family: 'Amiri', serif !important;
            font-size: 1.6rem !important;
            line-height: 2.2 !important;
            text-align: right !important;
            direction: rtl !important;
            font-weight: 500;
        }

        /* Mixed content handling */
        .mixed-content {
            direction: ltr;
            text-align: left;
        }

        .mixed-content .arabic-text {
            direction: rtl;
            text-align: right;
            display: inline-block;
        }

        #notebook-paper {
            background-color: #F8F9FA;
            background-image: linear-gradient(#000000 1px, transparent 1px);
            background-size: 100% 2.4em;
            line-height: 2.4em;
            box-shadow: 
                0 20px 25px -5px rgba(0, 0, 0, 0.1),
                0 10px 10px -5px rgba(0, 0, 0, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(229, 231, 235, 0.5);
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: none;
        }

        /* خاص بالنص بين الخطوط - النمط المخطط */
        #notebook-paper.lined #editor {
            padding-top: calc(1em + 1.1em) !important; /* إضافة padding لجعل النص بين الخطوط */
            line-height: 2.4em !important; /* محاذاة مع المسافة بين الخطوط */
        }

        #notebook-paper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        #notebook-paper.grid {
            background-image: linear-gradient(#000000 1px, transparent 1px),
                              linear-gradient(90deg, #d1d5db 1px, transparent 1px);
            background-size: 2em 2em;
            line-height: 2em;
        }
        
        #notebook-paper.dots {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 25px 25px;
        }
        
        #notebook-paper.blank {
            background-image: none;
        }
        
        #notebook-paper.brainstorm {
            background-image: radial-gradient(circle at center, #f0f4ff 0%, #ffffff 100%);
        }

        /* Paper Color Variations - Professional Paper Colors */
        #notebook-paper.paper-white {
            background-color: #F8F9FA;
        }

        #notebook-paper.paper-white.lined {
            background-color: #F8F9FA;
            background-image: linear-gradient(#000000 1px, transparent 1px);
        }

        #notebook-paper.paper-white.lined #editor {
            padding-top: calc(1em + 1.1em) !important;
            line-height: 2.4em !important;
        }

        #notebook-paper.paper-white.lined #editor.arabic-content {
            padding-top: calc(1em + 1.1em) !important;
            line-height: 2.6em !important;
        }

        #notebook-paper.paper-white.grid {
            background-color: #F8F9FA;
            background-image: linear-gradient(#000000 1px, transparent 1px),
                              linear-gradient(90deg, #d1d5db 1px, transparent 1px);
        }

        #notebook-paper.paper-white.dots {
            background-color: #F8F9FA;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
        }

        #notebook-paper.paper-mint {
            background-color: #E8F5E8;
        }

        #notebook-paper.paper-mint.lined {
            background-color: #E8F5E8;
            background-image: linear-gradient(#000000 1px, transparent 1px);
        }

        #notebook-paper.paper-mint.lined #editor {
            padding-top: calc(1em + 1.1em) !important;
            line-height: 2.4em !important;
        }

        #notebook-paper.paper-mint.lined #editor.arabic-content {
            padding-top: calc(1em + 1.1em) !important;
            line-height: 2.6em !important;
        }

        #notebook-paper.paper-mint.grid {
            background-color: #E8F5E8;
            background-image: linear-gradient(#000000 1px, transparent 1px),
                              linear-gradient(90deg, #c7d2cc 1px, transparent 1px);
        }

        #notebook-paper.paper-mint.dots {
            background-color: #E8F5E8;
            background-image: radial-gradient(#a7b8a8 1px, transparent 1px);
        }

        #notebook-paper.paper-gray {
            background-color: #F3F4F6;
        }

        #notebook-paper.paper-gray.lined {
            background-color: #F3F4F6;
            background-image: linear-gradient(#000000 1px, transparent 1px);
        }

        #notebook-paper.paper-gray.lined #editor {
            padding-top: calc(1em + 1.1em) !important;
            line-height: 2.4em !important;
        }

        #notebook-paper.paper-gray.lined #editor.arabic-content {
            padding-top: calc(1em + 1.1em) !important;
            line-height: 2.6em !important;
        }

        #notebook-paper.paper-gray.grid {
            background-color: #F3F4F6;
            background-image: linear-gradient(#000000 1px, transparent 1px),
                              linear-gradient(90deg, #d1d5db 1px, transparent 1px);
        }

        #notebook-paper.paper-gray.dots {
            background-color: #F3F4F6;
            background-image: radial-gradient(#9ca3af 1px, transparent 1px);
        }

        #notebook-paper.paper-cream {
            background-color: #FDF6E3;
        }

        #notebook-paper.paper-cream.lined {
            background-color: #FDF6E3;
            background-image: linear-gradient(#000000 1px, transparent 1px);
        }

        #notebook-paper.paper-cream.lined #editor {
            padding-top: calc(1em + 1.1em) !important;
            line-height: 2.4em !important;
        }

        #notebook-paper.paper-cream.lined #editor.arabic-content {
            padding-top: calc(1em + 1.1em) !important;
            line-height: 2.6em !important;
        }

        #notebook-paper.paper-cream.grid {
            background-color: #FDF6E3;
            background-image: linear-gradient(#000000 1px, transparent 1px),
                              linear-gradient(90deg, #e5d3a9 1px, transparent 1px);
        }

        #notebook-paper.paper-cream.dots {
            background-color: #FDF6E3;
            background-image: radial-gradient(#d4c5a0 1px, transparent 1px);
        }

        #notebook-paper.paper-peach {
            background-color: #FEF2F2;
        }

        #notebook-paper.paper-peach.lined {
            background-color: #FEF2F2;
            background-image: linear-gradient(#000000 1px, transparent 1px);
        }

        #notebook-paper.paper-peach.lined #editor {
            padding-top: calc(1em + 1.1em) !important;
            line-height: 2.4em !important;
        }

        #notebook-paper.paper-peach.lined #editor.arabic-content {
            padding-top: calc(1em + 1.1em) !important;
            line-height: 2.6em !important;
        }

        #notebook-paper.paper-peach.grid {
            background-color: #FEF2F2;
            background-image: linear-gradient(#000000 1px, transparent 1px),
                              linear-gradient(90deg, #f3c6a7 1px, transparent 1px);
        }

        #notebook-paper.paper-peach.dots {
            background-color: #FEF2F2;
            background-image: radial-gradient(#e5b8a2 1px, transparent 1px);
        }

        #notebook-paper.paper-rose {
            background-color: #FDF2F8;
        }

        #notebook-paper.paper-rose.lined {
            background-color: #FDF2F8;
            background-image: linear-gradient(#000000 1px, transparent 1px);
        }

        #notebook-paper.paper-rose.lined #editor {
            padding-top: calc(1em + 1.1em) !important;
            line-height: 2.4em !important;
        }

        #notebook-paper.paper-rose.lined #editor.arabic-content {
            padding-top: calc(1em + 1.1em) !important;
            line-height: 2.6em !important;
        }

        #notebook-paper.paper-rose.grid {
            background-color: #FDF2F8;
            background-image: linear-gradient(#000000 1px, transparent 1px),
                              linear-gradient(90deg, #f2c2c5 1px, transparent 1px);
        }

        #notebook-paper.paper-rose.dots {
            background-color: #FDF2F8;
            background-image: radial-gradient(#e4b4b7 1px, transparent 1px);
        }

        #notebook-paper.paper-beige {
            background-color: #FFFBEB;
        }

        #notebook-paper.paper-beige.lined {
            background-color: #FFFBEB;
            background-image: linear-gradient(#000000 1px, transparent 1px);
        }

        #notebook-paper.paper-beige.lined #editor {
            padding-top: calc(1em + 1.1em) !important;
            line-height: 2.4em !important;
        }

        #notebook-paper.paper-beige.lined #editor.arabic-content {
            padding-top: calc(1em + 1.1em) !important;
            line-height: 2.6em !important;
        }

        #notebook-paper.paper-beige.grid {
            background-color: #FFFBEB;
            background-image: linear-gradient(#000000 1px, transparent 1px),
                              linear-gradient(90deg, #f0d4b8 1px, transparent 1px);
        }

        #notebook-paper.paper-beige.dots {
            background-color: #FFFBEB;
            background-image: radial-gradient(#e2c4ad 1px, transparent 1px);
        }

        #editor {
            outline: none;
            padding: 1em 3em 3em 4em;
            font-size: 1.4rem;
            min-height: 80vh;
            position: relative;
            line-height: 1.8;
            color: #1e293b;
            unicode-bidi: bidi-override;
            text-align: left;
            direction: ltr;
        }

        /* Font size dynamic adjustments */
        #editor {
            transition: font-size 0.3s ease-in-out;
        }

        /* Arabic content font size adjustments */
        #editor.arabic-content {
            font-size: calc(var(--current-font-size, 1.4rem) + 0.2rem) !important;
        }

        /* Mobile adjustments */
        @media (max-width: 1023px) {
            #editor {
                padding: 0.5em 1em 1em 1em;
                font-size: 1.3rem;
                min-height: 70vh;
                text-align: left;
                direction: ltr;
            }
            
            /* Enhanced mobile responsiveness for small screens */
            @media (max-width: 480px) {
                #editor {
                    padding: 0.3em 0.8em 0.8em 0.8em;
                    font-size: 1.2rem;
                    min-height: 60vh;
                }
            }
            
            #editor.arabic-content {
                padding: 0.5em 1em 1em 1em;
                font-size: 1.5rem;
                text-align: right;
                direction: rtl;
            }
            
            /* النص العربي مع الخطوط على الموبايل */
            #notebook-paper.lined #editor {
                padding-top: calc(0.5em + 1.1em) !important;
                line-height: 2.4em !important;
            }
            
            #notebook-paper.lined #editor.arabic-content {
                padding-top: calc(0.5em + 1.1em) !important;
                line-height: 2.6em !important;
            }
            
            #currentDateTime {
                padding-top: 1rem !important;
                font-size: 1.3rem !important;
                text-align: center !important;
                font-weight: 600 !important;
                margin-bottom: 0.5rem !important;
            }
        }

        /* Date and Time Header Styling */
        #currentDateTime {
            font-family: 'Patrick Hand', cursive;
            color: #4b5563;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            letter-spacing: 0.5px;
        }

        /* Arabic content in editor - Desktop */
        #editor.arabic-content {
            direction: rtl;
            text-align: right;
            padding: 1em 4em 3em 3em;
            font-size: 1.6rem;
        }

        /* النص العربي مع الخطوط */
        #notebook-paper.lined #editor.arabic-content {
            padding-top: calc(1em + 1.1em) !important;
            line-height: 2.6em !important;
        }

        /* الخط الأحمر الرأسي للنص العربي - فقط في حالة lined على سطح المكتب */
        #notebook-paper.lined #editor.arabic-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: auto;
            right: 3em;
            bottom: 0;
            width: 2px;
            background-color: rgba(239, 68, 68, 0.6);
        }
        
        /* الخط الأحمر الرأسي - يظهر فقط في حالة lined على سطح المكتب */
        #notebook-paper.lined #editor::before {
            content: '';
            position: absolute;
            top: 0;
            left: 3em;
            bottom: 0;
            width: 2px;
            background-color: rgba(239, 68, 68, 0.6);
        }

        /* إخفاء الخط الأحمر الرأسي في جميع الحالات على الهواتف */
        @media (max-width: 1023px) {
            #notebook-paper #editor::before,
            #notebook-paper #editor.arabic-content::before {
                display: none !important;
            }
        }
        
        /* Professional Button Styles */
        .control-btn.active {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            color: white;
            box-shadow: 
                inset 0 1px 2px rgba(0,0,0,0.1),
                0 4px 8px -2px rgba(30, 64, 175, 0.3);
        }

        /* Format Button Styles */
        #btn-lined.active, #btn-grid.active, #btn-dots.active, #btn-blank.active,
        #btn-lined-mobile.active, #btn-grid-mobile.active, #btn-dots-mobile.active, #btn-blank-mobile.active {
            background: linear-gradient(135deg, #1e40af, #1e3a8a);
            color: white;
            box-shadow: 0 2px 4px rgba(30, 64, 175, 0.3);
        }

        /* Toolbar responsive improvements */
        @media (max-width: 1023px) {
            .toolbar-section {
                padding: 0.5rem 0.75rem;
                margin: 0.25rem 0;
            }
            
            .btn-group {
                padding: 3px;
                gap: 3px;
            }
            
            .btn-group button {
                flex: 1;
                min-width: 0;
                justify-content: center;
            }
            
            .control-label {
                font-size: 0.8rem;
                min-width: auto;
            }
        }

        /* Enhanced toolbar styling */
        .toolbar-section {
            background: rgba(255, 255, 255, 0.6);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .toolbar-divider {
            width: 1px;
            height: 2rem;
            background: linear-gradient(to bottom, transparent, rgba(148, 163, 184, 0.3), transparent);
        }

        /* Button group styling */
        .btn-group {
            display: flex;
            background: rgba(241, 245, 249, 0.8);
            border-radius: 10px;
            padding: 4px;
            gap: 4px;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        /* Format buttons equal width */
        .btn-group button {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 0;
        }

        /* Label consistency */
        .control-label {
            font-weight: 600;
            color: #334155;
            font-size: 0.875rem;
            white-space: nowrap;
        }

        /* Professional Dropdown Styles */
        .dropdown-container {
            position: relative;
            display: inline-block;
        }

        .dropdown-trigger {
            background: rgba(255, 255, 255, 0.9);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 10px;
            padding: 0.6rem 0.9rem;
            font-weight: 500;
            color: #475569;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.4rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.06);
            min-width: 90px;
            justify-content: space-between;
            font-size: 0.875rem;
            position: relative;
            overflow: hidden;
        }

        .dropdown-trigger::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            transition: left 0.5s;
        }

        .dropdown-trigger:hover::before {
            left: 100%;
        }

        .dropdown-trigger:hover {
            background: rgba(255, 255, 255, 0.95);
            border-color: rgba(59, 130, 246, 0.4);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.15), 0 2px 8px rgba(0, 0, 0, 0.1);
            color: #1e40af;
        }

        .dropdown-trigger:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .dropdown-trigger.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3), 0 2px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .dropdown-trigger.active::before {
            display: none;
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%) translateY(-10px) scale(0.95);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.98) 100%);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            box-shadow: 
                0 32px 64px -12px rgba(0, 0, 0, 0.12),
                0 16px 32px -8px rgba(59, 130, 246, 0.1),
                0 0 0 1px rgba(255, 255, 255, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            min-width: 280px;
            max-width: 360px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0) scale(1);
        }

        .dropdown-header {
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.08) 0%, 
                rgba(147, 197, 253, 0.12) 50%,
                rgba(59, 130, 246, 0.06) 100%);
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid rgba(59, 130, 246, 0.15);
            position: relative;
            overflow: hidden;
        }

        .dropdown-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(59, 130, 246, 0.4) 20%, 
                rgba(147, 197, 253, 0.6) 50%,
                rgba(59, 130, 246, 0.4) 80%, 
                transparent);
        }

        .dropdown-header::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .dropdown-header h3 {
            margin: 0;
            font-size: 0.95rem;
            font-weight: 700;
            color: #1e40af;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            letter-spacing: 0.025em;
            position: relative;
            z-index: 1;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }

        .dropdown-header h3 i {
            font-size: 0.9rem;
            padding: 0.4rem;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .dropdown-content {
            padding: 1.5rem;
            background: linear-gradient(180deg, 
                rgba(255, 255, 255, 0.1) 0%, 
                transparent 100%);
        }

        .dropdown-section {
            margin-bottom: 1.25rem;
            position: relative;
        }

        .dropdown-section:last-child {
            margin-bottom: 0;
        }

        .dropdown-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
            padding-left: 0.5rem;
            position: relative;
        }

        .dropdown-section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 12px;
            background: linear-gradient(180deg, #3b82f6, #1d4ed8);
            border-radius: 2px;
        }

        .dropdown-grid {
            display: grid;
            gap: 0.5rem;
            padding: 0.5rem;
            background: rgba(248, 250, 252, 0.4);
            border-radius: 12px;
            border: 1px solid rgba(226, 232, 240, 0.6);
        }

        .dropdown-grid.cols-2 { grid-template-columns: repeat(2, 1fr); }
        .dropdown-grid.cols-3 { grid-template-columns: repeat(3, 1fr); }
        .dropdown-grid.cols-4 { grid-template-columns: repeat(4, 1fr); }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(226, 232, 240, 0.6);
            font-size: 0.875rem;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .dropdown-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(59, 130, 246, 0.15) 30%, 
                rgba(147, 197, 253, 0.2) 50%,
                rgba(59, 130, 246, 0.15) 70%, 
                transparent);
            transition: left 0.5s ease;
        }

        .dropdown-item:hover::before {
            left: 100%;
        }

        .dropdown-item:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
            transform: translateX(3px) translateY(-1px);
            color: #1e40af;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .dropdown-item.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 
                0 4px 12px rgba(59, 130, 246, 0.3),
                0 2px 6px rgba(59, 130, 246, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border-color: #2563eb;
            transform: translateX(2px) translateY(-1px);
        }

        .dropdown-item.active::before {
            display: none;
        }

        .dropdown-item.active:hover {
            transform: translateX(3px) translateY(-2px);
            box-shadow: 
                0 6px 16px rgba(59, 130, 246, 0.4),
                0 3px 8px rgba(59, 130, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .color-swatch {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.95);
            box-shadow: 
                0 4px 8px rgba(0, 0, 0, 0.15), 
                0 2px 4px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            flex-shrink: 0;
        }

        .color-swatch::after {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 50%;
            border: 2px solid rgba(59, 130, 246, 0.4);
            opacity: 0;
            transition: all 0.3s ease;
            transform: scale(0.8);
        }

        .color-swatch:hover {
            transform: scale(1.2);
            box-shadow: 
                0 6px 16px rgba(0, 0, 0, 0.2), 
                0 3px 8px rgba(0, 0, 0, 0.15),
                0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        .color-swatch:hover::after {
            opacity: 1;
            transform: scale(1);
        }

        .dropdown-item.active .color-swatch {
            border-color: rgba(255, 255, 255, 1);
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.3), 
                0 2px 6px rgba(0, 0, 0, 0.2),
                0 0 0 3px rgba(255, 255, 255, 0.8);
        }

        .paper-swatch {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            flex-shrink: 0;
        }

        .paper-swatch::after {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 8px;
            border: 2px solid rgba(59, 130, 246, 0.5);
            opacity: 0;
            transition: all 0.3s ease;
            transform: scale(0.8);
        }

        .paper-swatch:hover {
            transform: scale(1.15);
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 
                0 4px 8px rgba(59, 130, 246, 0.2),
                0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .paper-swatch:hover::after {
            opacity: 1;
            transform: scale(1);
        }

        .dropdown-item.active .paper-swatch {
            border-color: rgba(255, 255, 255, 0.9);
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.2),
                0 0 0 2px rgba(255, 255, 255, 0.8);
        }

        .size-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            padding: 1rem;
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.06) 0%, 
                rgba(147, 197, 253, 0.08) 50%,
                rgba(59, 130, 246, 0.04) 100%);
            border-radius: 12px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            position: relative;
            overflow: hidden;
        }

        .size-control::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(59, 130, 246, 0.4), 
                transparent);
        }

        .size-button {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.75rem;
            position: relative;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        .size-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.4), 
                transparent);
            transition: left 0.4s;
        }

        .size-button:hover::before {
            left: 100%;
        }

        .size-button:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-color: rgba(59, 130, 246, 0.5);
        }

        .size-display {
            min-width: 70px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 700;
            color: #1e40af;
            background: rgba(255, 255, 255, 0.9);
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            position: relative;
        }

        .size-display::before {
            content: 'Current';
            position: absolute;
            top: -1.5rem;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.6rem;
            font-weight: 500;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Mobile dropdown adjustments */
        @media (max-width: 768px) {
            .dropdown-menu {
                min-width: 320px;
                max-width: 95vw;
                left: 50%;
                transform: translateX(-50%) translateY(-10px) scale(0.95);
            }
            
            .dropdown-menu.show {
                transform: translateX(-50%) translateY(0) scale(1);
            }
            
            .dropdown-trigger {
                min-width: 85px;
                padding: 0.5rem 0.7rem;
                font-size: 0.8rem;
            }
            
            .dropdown-content {
                padding: 1.25rem;
            }
            
            .dropdown-header {
                padding: 1rem 1.25rem;
            }
        }

        /* Enhanced chevron animation */
        .dropdown-trigger.active i[id$="Chevron"] {
            color: rgba(255, 255, 255, 0.9) !important;
            transform: rotate(180deg);
        }

        /* Footer for dropdowns */
        .dropdown-footer {
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, 
                rgba(248, 250, 252, 0.8) 0%, 
                rgba(226, 232, 240, 0.6) 100%);
            border-top: 1px solid rgba(59, 130, 246, 0.1);
            text-align: center;
        }

        .dropdown-footer-text {
            font-size: 0.7rem;
            color: #64748b;
            font-weight: 500;
            letter-spacing: 0.025em;
        }

        /* Header enhancements */
        .navbar-brand-icon:hover {
            transform: rotate(5deg) scale(1.05);
            box-shadow: 0 12px 30px -5px rgba(59, 130, 246, 0.6);
        }

        /* Action buttons in header */
        .header-action-btn {
            position: relative;
            overflow: hidden;
        }

        .header-action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .header-action-btn:hover::before {
            left: 100%;
        }

        /* Enhanced Clear Button Styling */
        .header-action-btn[onclick="clearContent()"] {
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .header-action-btn[onclick="clearContent()"]:hover {
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
            transform: scale(1.05) translateY(-2px);
        }

        /* Hover effects for control buttons - removed unused .control-panel selector */
        

        
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        @keyframes tilt {
            0%, 50%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(0.5deg); }
            75% { transform: rotate(-0.5deg); }
        }

        .animate-tilt {
            animation: tilt 10s infinite linear;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 8px 32px 0 rgba(31, 38, 135, 0.37),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* .gradient-border class removed - was unused */

        /* Professional scrollbar */
        ::-webkit-scrollbar { 
            width: 8px; 
        }
        
        ::-webkit-scrollbar-track { 
            background: #f1f5f9;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb { 
            background: #64748b;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover { 
            background: #475569;
        }

        /* Paper color button styles */
        .paper-color-white { background-color: #F8F9FA; }
        .paper-color-mint { background-color: #E8F5E8; }
        .paper-color-gray { background-color: #F3F4F6; }
        .paper-color-cream { background-color: #FDF6E3; }
        .paper-color-peach { background-color: #FEF2F2; }
        .paper-color-rose { background-color: #FDF2F8; }
        .paper-color-beige { background-color: #FFFBEB; }

        /* Hover and focus effects for buttons */
        button:hover, button:focus {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }

        /* Remove default focus outline */
        button:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }

        /* Navbar enhancements */
        .navbar-brand-icon {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .navbar-brand-icon:hover {
            transform: rotate(5deg) scale(1.05);
            box-shadow: 0 8px 25px -5px rgba(59, 130, 246, 0.5);
        }
        
        .nav-item {
            transition: all 0.2s ease-in-out;
        }
        
        .nav-item:hover {
            transform: translateY(-1px);
        }

        /* Live indicator animation */
        @keyframes live-pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.1);
            }
        }
        
        .live-indicator {
            animation: live-pulse 2s infinite;
        }

        /* Footer Enhancements */
        .footer {
            position: relative;
            overflow: hidden;
        }
        
        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.03) 0%, rgba(147, 197, 253, 0.05) 50%, rgba(59, 130, 246, 0.03) 100%);
            pointer-events: none;
        }
        
        .footer .copyright a {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .footer .copyright a:hover {
            transform: translateY(-1px);
            text-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);
        }
        
        .footer .copyright span[class*="bg-"] {
            transition: all 0.2s ease-in-out;
        }
        
        .footer .copyright span[class*="bg-"]:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Modern Voice Button with Professional Glassmorphism */
        #fixedVoiceButton {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 20px 40px rgba(59, 130, 246, 0.3));
        }

        #whatsappVoiceBtn {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.9) 0%, 
                rgba(99, 102, 241, 0.95) 50%,
                rgba(139, 92, 246, 0.9) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 20px 40px -10px rgba(59, 130, 246, 0.4),
                0 10px 20px -5px rgba(99, 102, 241, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.4),
                inset 0 -1px 0 rgba(0, 0, 0, 0.1);
        }

        #whatsappVoiceBtn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 30%, 
                rgba(255, 255, 255, 0.4) 0%, 
                rgba(255, 255, 255, 0.1) 50%,
                transparent 70%);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1;
        }

        #whatsappVoiceBtn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent, 
                rgba(255, 255, 255, 0.05), 
                transparent);
            opacity: 0;
            transition: all 0.6s ease;
            animation: rotate-shimmer 4s linear infinite;
            z-index: 0;
        }

        @keyframes rotate-shimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #whatsappVoiceBtn:hover::before {
            opacity: 1;
        }

        #whatsappVoiceBtn:hover::after {
            opacity: 1;
        }

        #whatsappVoiceBtn:hover {
            transform: translateY(-2px) scale(1.05);
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 1) 0%, 
                rgba(99, 102, 241, 1) 50%,
                rgba(139, 92, 246, 1) 100%);
            box-shadow: 
                0 25px 50px -12px rgba(59, 130, 246, 0.5),
                0 15px 25px -8px rgba(99, 102, 241, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        #whatsappVoiceBtn:active {
            transform: translateY(-1px) scale(0.98);
            transition: all 0.1s ease;
        }

        /* Recording State with Advanced Animations */
        #whatsappVoiceBtn.recording {
            background: linear-gradient(135deg, 
                #ef4444 0%, 
                #dc2626 40%,
                #b91c1c 100%);
            box-shadow: 
                0 0 0 0 rgba(239, 68, 68, 0.8),
                0 20px 40px -10px rgba(239, 68, 68, 0.6),
                0 10px 20px -5px rgba(220, 38, 38, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            animation: recording-pulse 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
        }

        #whatsappVoiceBtn.recording::before {
            opacity: 1;
            background: radial-gradient(circle at 50% 50%, 
                rgba(255, 255, 255, 0.3) 0%, 
                transparent 70%);
        }

        #whatsappVoiceBtn.recording #whatsappMicIcon {
            animation: mic-recording 1.5s infinite ease-in-out;
            color: white;
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.8));
        }

        @keyframes recording-pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.8),
                            0 20px 40px -10px rgba(239, 68, 68, 0.6),
                            0 10px 20px -5px rgba(220, 38, 38, 0.5);
            }
            50% {
                box-shadow: 0 0 0 20px rgba(239, 68, 68, 0),
                            0 20px 40px -10px rgba(239, 68, 68, 0.6),
                            0 10px 20px -5px rgba(220, 38, 38, 0.5);
            }
        }

        @keyframes mic-recording {
            0%, 100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            25% {
                transform: scale(1.1) rotate(-2deg);
                opacity: 0.9;
            }
            50% {
                transform: scale(1.2) rotate(0deg);
                opacity: 0.8;
            }
            75% {
                transform: scale(1.1) rotate(2deg);
                opacity: 0.9;
            }
        }

        /* Microphone Icon Enhancements */
        #whatsappMicIcon {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        #whatsappVoiceBtn:hover #whatsappMicIcon {
            transform: scale(1.15);
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4));
        }

        /* Advanced Recording Indicators */
        #recordingIndicator {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: 2px solid rgba(255, 255, 255, 0.9);
            animation: indicator-pulse 1.5s infinite ease-in-out;
            box-shadow: 
                0 0 0 0 rgba(239, 68, 68, 0.8),
                0 4px 12px rgba(239, 68, 68, 0.4);
        }
        
        #recordingIndicator.show {
            opacity: 1;
            transform: scale(1);
        }

        #recordingIndicator .indicator-dot {
            background: white;
            animation: dot-pulse 1s infinite ease-in-out;
        }

        @keyframes indicator-pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.8),
                            0 4px 12px rgba(239, 68, 68, 0.4);
            }
            50% {
                transform: scale(1.15);
                box-shadow: 0 0 0 8px rgba(239, 68, 68, 0),
                            0 6px 16px rgba(239, 68, 68, 0.6);
            }
        }

        @keyframes dot-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(0.8); }
        }

        /* Enhanced Recording Status */
        #recordingStatus {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(-8px);
            opacity: 0;
            min-width: 200px;
            background: linear-gradient(135deg, 
                rgba(15, 23, 42, 0.95) 0%, 
                rgba(30, 41, 59, 0.98) 100%);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 25px 50px -12px rgba(0, 0, 0, 0.25),
                0 0 0 1px rgba(255, 255, 255, 0.05),
                0 0 20px rgba(239, 68, 68, 0.2);
        }
        
        #recordingStatus.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        #recordingStatus::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background: linear-gradient(135deg, 
                rgba(239, 68, 68, 0.3) 0%, 
                rgba(220, 38, 38, 0.2) 100%);
            border-radius: inherit;
            z-index: -1;
        }

        #recordingStatus .status-icon {
            background: #ef4444;
            animation: status-blink 1.2s infinite ease-in-out;
        }

        @keyframes status-blink {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.4; transform: scale(0.9); }
        }

        /* Voice Level Indicator */
        .voice-level-container {
            display: flex;
            align-items: center;
            gap: 2px;
            margin-left: 8px;
        }

        .voice-level-bar {
            width: 3px;
            background: linear-gradient(to top, #ef4444, #fca5a5);
            border-radius: 2px;
            transition: height 0.1s ease;
        }

        .voice-level-bar:nth-child(1) { height: 8px; animation: voice-wave 0.8s infinite ease-in-out 0s; }
        .voice-level-bar:nth-child(2) { height: 12px; animation: voice-wave 0.8s infinite ease-in-out 0.1s; }
        .voice-level-bar:nth-child(3) { height: 16px; animation: voice-wave 0.8s infinite ease-in-out 0.2s; }
        .voice-level-bar:nth-child(4) { height: 12px; animation: voice-wave 0.8s infinite ease-in-out 0.3s; }
        .voice-level-bar:nth-child(5) { height: 8px; animation: voice-wave 0.8s infinite ease-in-out 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.5); opacity: 0.6; }
            50% { transform: scaleY(1); opacity: 1; }
        }

        /* Professional Sound Waves */
        .sound-waves {
            pointer-events: none;
        }

        .sound-wave {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: sound-ripple 2s infinite ease-out;
        }

        .sound-wave:nth-child(1) {
            top: 20%;
            left: 20%;
            right: 20%;
            bottom: 20%;
            animation-delay: 0s;
        }

        .sound-wave:nth-child(2) {
            top: 10%;
            left: 10%;
            right: 10%;
            bottom: 10%;
            animation-delay: 0.4s;
        }

        .sound-wave:nth-child(3) {
            top: 0%;
            left: 0%;
            right: 0%;
            bottom: 0%;
            animation-delay: 0.8s;
        }

        @keyframes sound-ripple {
            0% {
                opacity: 1;
                transform: scale(0.8);
            }
            100% {
                opacity: 0;
                transform: scale(1.4);
            }
        }

        /* Show sound waves when recording */
        #whatsappVoiceBtn.recording .sound-waves {
            opacity: 1;
        }

        /* Professional Button Size Fix */
        .w-18 { width: 4.5rem; }
        .h-18 { height: 4.5rem; }

        /* Recording Pulse Animation */
        .recording-pulse {
            color: #ef4444;
            animation: pulse-red 1s infinite ease-in-out;
            font-weight: bold;
        }

        @keyframes pulse-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* Professional Accessibility Features */
        #fixedVoiceButton:focus-within {
            outline: 3px solid rgba(59, 130, 246, 0.6);
            outline-offset: 4px;
        }

        /* Enhanced Mobile Experience */
        @media (max-width: 768px) {
            #fixedVoiceButton {
                bottom: 1rem;
                right: 1rem;
            }
            
            .w-18 { width: 4rem; }
            .h-18 { height: 4rem; }
            
            #whatsappMicIcon {
                font-size: 1.25rem;
            }
            
            #recordingStatus {
                right: -1rem;
                min-width: 250px;
                font-size: 0.75rem;
                padding: 0.75rem 1rem;
            }
            
            .voice-level-bar {
                width: 2px;
            }
        }

        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            #whatsappVoiceBtn {
                border: 3px solid white;
            }
            
            #whatsappVoiceBtn.recording {
                border: 3px solid yellow;
            }
        }

        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            #whatsappVoiceBtn,
            #recordingIndicator,
            .sound-wave,
            .voice-level-bar {
                animation: none;
            }
            
            #whatsappVoiceBtn.recording {
                background: #ef4444;
            }
        }

        /* Dark Mode Enhancements */
        @media (prefers-color-scheme: dark) {
            #recordingStatus {
                background: linear-gradient(135deg, 
                    rgba(0, 0, 0, 0.95) 0%, 
                    rgba(15, 23, 42, 0.98) 100%);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }
        }

        /* Professional Recording Session Styles */
        .recording-session-header {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.08) 0%, 
                rgba(147, 197, 253, 0.12) 100%);
            border-left: 4px solid #3b82f6;
            border-radius: 0 12px 12px 0;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .session-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .session-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e40af;
            display: flex;
            align-items: center;
        }

        .session-datetime {
            font-size: 0.875rem;
            color: #64748b;
            display: flex;
            align-items: center;
            font-weight: 500;
        }

        .session-divider {
            margin-top: 1rem;
            height: 2px;
            background: linear-gradient(90deg, 
                #3b82f6 0%, 
                #93c5fd 50%, 
                #3b82f6 100%);
            border-radius: 1px;
        }

        .session-instructions {
            margin-top: 1rem;
            font-size: 0.875rem;
            color: #64748b;
            font-style: italic;
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            background: rgba(59, 130, 246, 0.05);
            border-radius: 8px;
            border-left: 3px solid #3b82f6;
        }

        .session-instructions i {
            color: #3b82f6;
            margin-right: 0.5rem;
        }

        /* Transcription Block Styles */
        .transcription-block {
            margin: 1.5rem 0;
            padding: 1.25rem;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(226, 232, 240, 0.6);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            position: relative;
        }

        .transcription-block:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .transcription-block.selected-for-merge {
            border: 2px solid #10b981;
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.1) 0%, 
                rgba(167, 243, 208, 0.15) 100%);
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.2);
            transform: translateY(-2px);
        }

        .arabic-transcription {
            border-left: 4px solid #10b981;
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.05) 0%, 
                rgba(167, 243, 208, 0.08) 100%);
        }

        .english-transcription {
            border-left: 4px solid #8b5cf6;
            background: linear-gradient(135deg, 
                rgba(139, 92, 246, 0.05) 0%, 
                rgba(196, 181, 253, 0.08) 100%);
        }

        .merged-transcription {
            border-left: 4px solid #f59e0b;
            background: linear-gradient(135deg, 
                rgba(245, 158, 11, 0.08) 0%, 
                rgba(253, 230, 138, 0.12) 100%);
            border: 2px solid rgba(245, 158, 11, 0.2);
        }

        .merged-content {
            padding: 1rem 0;
        }

        .merge-separator {
            margin: 1rem 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(245, 158, 11, 0.3) 20%, 
                rgba(245, 158, 11, 0.5) 50%,
                rgba(245, 158, 11, 0.3) 80%, 
                transparent 100%);
            position: relative;
        }

        .merge-separator::before {
            content: '⬢';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: white;
            color: #f59e0b;
            font-size: 0.8rem;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .transcription-header {
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(226, 232, 240, 0.5);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .transcription-meta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            font-size: 0.75rem;
            color: #64748b;
            flex: 1;
        }

        .transcription-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .transcription-actions button {
            padding: 0.375rem 0.625rem;
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.8);
            color: #64748b;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .transcription-actions button:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.4);
            color: #3b82f6;
            transform: translateY(-1px);
        }

        .merge-btn.selected {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-color: #10b981;
            box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
        }

        .merge-btn.selected:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-1px);
        }

        .transcription-meta span {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-weight: 500;
        }

        .transcription-time {
            color: #059669;
        }

        .transcription-date {
            color: #7c3aed;
        }

        .transcription-language {
            color: #dc2626;
            font-weight: 600;
        }

        .transcription-content {
            font-size: 1rem;
            line-height: 1.7;
            color: #1e293b;
            font-weight: 500;
            padding: 0.5rem 0;
        }

        .rtl-content {
            direction: rtl;
            text-align: right;
            font-family: 'Tajawal', 'Cairo', 'Amiri', sans-serif;
        }

        .ltr-content {
            direction: ltr;
            text-align: left;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }

        .transcription-divider {
            margin-top: 1rem;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(148, 163, 184, 0.4) 20%, 
                rgba(148, 163, 184, 0.6) 50%,
                rgba(148, 163, 184, 0.4) 80%, 
                transparent 100%);
        }

                 /* Mobile Responsive Transcription */
         @media (max-width: 768px) {
             .recording-session-header {
                 padding: 1rem;
                 margin-bottom: 1.5rem;
             }

             .session-header-content {
                 flex-direction: column;
                 align-items: flex-start;
                 gap: 0.5rem;
             }

             .session-title {
                 font-size: 1.1rem;
             }

             .session-datetime {
                 font-size: 0.8rem;
             }

             .transcription-block {
                 margin: 1rem 0;
                 padding: 1rem;
             }

             .transcription-header {
                 flex-direction: column;
                 gap: 0.5rem;
             }

             .transcription-meta {
                 gap: 0.5rem;
                 font-size: 0.7rem;
             }

             .transcription-actions {
                 width: 100%;
                 justify-content: space-between;
             }

             .transcription-actions button {
                 padding: 0.25rem 0.5rem;
                 font-size: 0.7rem;
             }

             .transcription-content {
                 font-size: 0.9rem;
             }

             /* Mobile Merge Control Bar */
             #mergeControlBar {
                 padding: 0.75rem 1rem;
             }

             .merge-control-content {
                 flex-direction: column;
                 gap: 0.75rem;
             }

             .merge-info {
                 flex-direction: column;
                 gap: 0.5rem;
                 width: 100%;
             }

             .merge-counter {
                 font-size: 0.8rem;
             }

             .merge-preview {
                 font-size: 0.75rem;
                 max-width: 100%;
             }

             .merge-actions {
                 width: 100%;
                 justify-content: space-between;
             }

             .merge-action-btn {
                 padding: 0.375rem 0.75rem;
                 font-size: 0.8rem;
             }
         }

                 /* Blank Paper Mode for Recording */
         .blank-paper-mode {
             background: #ffffff !important;
             box-shadow: none !important;
             border: none !important;
         }

         .blank-paper-mode::before,
         .blank-paper-mode::after {
             display: none !important;
         }

                 /* Transcription Container */
        .transcription-container {
            margin-top: 1rem;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        /* Enhanced Recording Session Layout */
        .blank-paper-mode #editor {
            padding: 1rem 2rem !important;
            margin: 0 !important;
        }

        .blank-paper-mode .recording-session-header {
            margin-top: 0 !important;
            margin-bottom: 1.5rem !important;
        }

        .blank-paper-mode .transcription-block {
            margin: 0.75rem 0 !important;
        }

        .blank-paper-mode .transcription-block:first-child {
            margin-top: 0 !important;
        }

        .blank-paper-mode .transcription-block:last-child {
            margin-bottom: 1.5rem !important;
        }

        /* Ensure proper spacing in transcription container */
        .transcription-container > .transcription-block {
            margin-bottom: 1rem;
        }

        .transcription-container > .transcription-block:last-child:not(.session-summary) {
            margin-bottom: 1rem;
        }

        .transcription-container > .session-summary {
            margin-top: 2rem;
            margin-bottom: 0;
        }

         /* Session Summary Styles */
         .session-summary {
             margin: 2rem 0;
             padding: 1.5rem;
             background: linear-gradient(135deg, 
                 rgba(34, 197, 94, 0.08) 0%, 
                 rgba(134, 239, 172, 0.12) 100%);
             border: 1px solid rgba(34, 197, 94, 0.2);
             border-radius: 12px;
             border-left: 4px solid #22c55e;
             box-shadow: 0 4px 12px rgba(34, 197, 94, 0.15);
         }

         .summary-content {
             display: flex;
             flex-direction: column;
             gap: 1rem;
         }

         .summary-title {
             font-size: 1.125rem;
             font-weight: 700;
             color: #15803d;
             display: flex;
             align-items: center;
         }

         .summary-stats {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
             gap: 0.75rem;
         }

         .stat-item {
             display: flex;
             align-items: center;
             gap: 0.5rem;
             font-size: 0.875rem;
             color: #374151;
             font-weight: 500;
             padding: 0.5rem 0.75rem;
             background: rgba(255, 255, 255, 0.6);
             border-radius: 8px;
             border: 1px solid rgba(34, 197, 94, 0.1);
         }

         .stat-item i {
             color: #22c55e;
             width: 16px;
             text-align: center;
         }

         .summary-divider {
             margin-top: 1rem;
             height: 2px;
             background: linear-gradient(90deg, 
                 #22c55e 0%, 
                 #86efac 50%, 
                 #22c55e 100%);
             border-radius: 1px;
         }

         /* Print Styles for Transcriptions */
         @media print {
             .recording-session-header,
             .session-summary {
                 background: none;
                 border: 1px solid #ccc;
                 box-shadow: none;
             }

             .transcription-block {
                 break-inside: avoid;
                 background: none;
                 border: 1px solid #ddd;
                 box-shadow: none;
             }

             .transcription-meta span,
             .stat-item {
                 color: #333;
             }

             .summary-stats {
                 grid-template-columns: repeat(2, 1fr);
             }
         }

         /* Mobile Responsive Summary */
         @media (max-width: 768px) {
             .session-summary {
                 margin: 1.5rem 0;
                 padding: 1rem;
             }

             .summary-title {
                 font-size: 1rem;
             }

             .summary-stats {
                 grid-template-columns: 1fr;
                 gap: 0.5rem;
             }

                           .stat-item {
                  font-size: 0.8rem;
                  padding: 0.4rem 0.6rem;
              }
          }

        /* Merge Control Bar */
        #mergeControlBar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.95) 0%, 
                rgba(5, 150, 105, 0.98) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1rem 2rem;
            z-index: 1000;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.2);
        }

        #mergeControlBar.show {
            transform: translateY(0);
        }

        .merge-control-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .merge-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: white;
        }

        .merge-counter {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .merge-preview {
            font-size: 0.8rem;
                opacity: 0.9;
            max-width: 300px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .merge-actions {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .merge-action-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .merge-execute-btn {
            background: rgba(255, 255, 255, 0.9);
            color: #059669;
        }

        .merge-execute-btn:hover {
            background: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .merge-cancel-btn {
            background: rgba(239, 68, 68, 0.9);
            color: white;
        }

        .merge-cancel-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        .merge-clear-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .merge-clear-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Mobile adjustments for fixed button */
        @media (max-width: 768px) {
            #fixedVoiceButton {
                bottom: 5rem;
                right: 1.5rem;
            }
            
            #whatsappVoiceBtn {
                width: 5rem;
                height: 5rem;
            }
            
            #whatsappMicIcon {
                font-size: 1.5rem;
            }
            
            #recordingIndicator {
                top: -0.5rem;
                right: -0.5rem;
                width: 1.5rem;
                height: 1.5rem;
            }
        }

        /* Voice Tutorial Styles */
        .voice-tutorial {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
            color: white;
            box-shadow: 0 10px 25px -5px rgba(30, 64, 175, 0.3);
        }
        
        .voice-tutorial h3 {
            display: flex;
            align-items: center;
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }
        
        .voice-tutorial li {
            margin-bottom: 0.75rem;
            display: flex;
            align-items: flex-start;
        }
        
        .voice-tutorial .icon {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            flex-shrink: 0;
        }
        
        /* Mobile Footer Adjustments */
        @media (max-width: 1023px) {
            .footer {
                margin-top: 2rem;
            }
            
            .footer .copyright p {
                font-size: 0.8rem;
                line-height: 1.6;
            }
            
            .footer .copyright span.font-mono {
                font-size: 0.7rem;
                padding: 0.25rem 0.5rem;
            }
            
            .voice-tutorial {
                padding: 1rem;
                margin-top: 1rem;
            }
            
            .voice-tutorial h3 {
                font-size: 1.1rem;
            }
            
            .voice-tutorial li {
                font-size: 0.9rem;
            }
        }

        /* Language indicator styles */
        .language-indicator {
            display: inline-block;
            padding: 0.2rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
        .language-arabic {
            background: linear-gradient(135deg, #0d6efd 0%, #0d52ff 100%);
            color: white;
        }
        .language-english {
            background: linear-gradient(135deg, #dc3545 0%, #b02a37 100%);
            color: white;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50">
    <!-- Professional Header with Integrated Toolbar -->
    <div class="sticky top-0 z-50 bg-gradient-to-b from-blue-50 via-white to-slate-50 border-b-2 border-blue-200/30 shadow-xl shadow-slate-900/5">
        <!-- Main Navigation -->
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16 lg:h-20">
                <!-- Brand Section -->
                    <div class="flex items-center">
                        <!-- Elegant Quill Icon -->
                    <div class="navbar-brand-icon w-10 h-10 bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/30 cursor-pointer" role="img" aria-label="Script.ai logo">
                        <i class="fas fa-feather-alt text-white text-lg"></i>
                        </div>
                        <!-- Brand & Description -->
                    <div class="ml-4 hidden sm:block">
                            <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-slate-800 via-blue-800 to-blue-900 font-caveat tracking-wide">
                                Script.ai
                            </h1>
                        <p class="text-xs text-slate-600 font-patrick">Distinguished voice-powered intelligent writing companion</p>
                    </div>
                    <!-- Mobile Brand Name -->
                    <div class="ml-3 sm:hidden">
                        <h1 class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-slate-800 via-blue-800 to-blue-900 font-caveat tracking-wide">
                            Script.ai
                        </h1>
                        </div>
                    </div>
                    
                <!-- Professional Toolbar - Desktop -->
                <div class="hidden lg:flex items-center space-x-2.5">
                    <!-- Ink Colors Dropdown -->
                    <div class="dropdown-container">
                                                    <button class="dropdown-trigger" onclick="toggleDropdown('inkDropdown')" aria-label="Ink colors menu">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-pen text-blue-600 text-sm"></i>
                                    <span>Ink</span>
                                </div>
                                <i class="fas fa-chevron-down text-xs transition-transform duration-200 text-slate-400" id="inkChevron"></i>
                            </button>
                        <div class="dropdown-menu" id="inkDropdown">
                            <div class="dropdown-header">
                                <h3><i class="fas fa-pen"></i> Writing Ink Selection</h3>
                            </div>
                            <div class="dropdown-content">
                                <div class="dropdown-section-title">Choose Your Ink Color</div>
                                <div class="dropdown-grid cols-1">
                                    <div class="dropdown-item" onclick="changeColor('#1e40af'); selectInkColor('blue')">
                                        <div class="color-swatch" style="background-color: #1e40af;"></div>
                                        <div class="flex flex-col">
                                            <span class="font-semibold">Professional Blue</span>
                                            <span class="text-xs text-slate-500">Clean and modern for business writing</span>
                                        </div>
                                    </div>
                                    <div class="dropdown-item" onclick="changeColor('#1e293b'); selectInkColor('black')">
                                        <div class="color-swatch" style="background-color: #1e293b;"></div>
                                        <div class="flex flex-col">
                                            <span class="font-semibold">Classic Black</span>
                                            <span class="text-xs text-slate-500">Traditional and elegant for all purposes</span>
                                        </div>
                                    </div>
                                    <div class="dropdown-item" onclick="changeColor('#b91c1c'); selectInkColor('red')">
                                        <div class="color-swatch" style="background-color: #b91c1c;"></div>
                                        <div class="flex flex-col">
                                            <span class="font-semibold">Executive Red</span>
                                            <span class="text-xs text-slate-500">Bold and distinctive for important notes</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="dropdown-footer">
                                <div class="dropdown-footer-text">✨ Premium ink selection • Auto-save enabled</div>
                            </div>
                        </div>
                    </div>

                    <!-- Paper Format Dropdown -->
                    <div class="dropdown-container">
                                                    <button class="dropdown-trigger" onclick="toggleDropdown('formatDropdown')" aria-label="Paper format menu">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-grip-lines text-indigo-600 text-sm"></i>
                                    <span>Format</span>
                                </div>
                                <i class="fas fa-chevron-down text-xs transition-transform duration-200 text-slate-400" id="formatChevron"></i>
                            </button>
                        <div class="dropdown-menu" id="formatDropdown">
                            <div class="dropdown-header">
                                <h3><i class="fas fa-file-alt"></i> Paper Format Selection</h3>
                            </div>
                            <div class="dropdown-content">
                                <div class="dropdown-section-title">Choose Paper Style</div>
                                <div class="dropdown-grid cols-2">
                                    <div class="dropdown-item active" onclick="changeStyle('lined'); selectFormat('lined')" id="format-lined">
                                        <i class="fas fa-grip-lines text-lg text-blue-600"></i>
                                        <div class="flex flex-col items-start">
                                            <span class="font-semibold">Lined</span>
                                            <span class="text-xs text-slate-500">Perfect for notes</span>
                                        </div>
                                    </div>
                                    <div class="dropdown-item" onclick="changeStyle('grid'); selectFormat('grid')" id="format-grid">
                                        <i class="fas fa-th text-lg text-emerald-600"></i>
                                        <div class="flex flex-col items-start">
                                            <span class="font-semibold">Grid</span>
                                            <span class="text-xs text-slate-500">Great for diagrams</span>
                                        </div>
                                    </div>
                                    <div class="dropdown-item" onclick="changeStyle('dots'); selectFormat('dots')" id="format-dots">
                                        <i class="fas fa-braille text-lg text-purple-600"></i>
                                        <div class="flex flex-col items-start">
                                            <span class="font-semibold">Dots</span>
                                            <span class="text-xs text-slate-500">Modern bullet style</span>
                                        </div>
                                    </div>
                                    <div class="dropdown-item" onclick="changeStyle('blank'); selectFormat('blank')" id="format-blank">
                                        <i class="fas fa-square text-lg text-slate-600"></i>
                                        <div class="flex flex-col items-start">
                                            <span class="font-semibold">Blank</span>
                                            <span class="text-xs text-slate-500">Clean canvas</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="dropdown-footer">
                                <div class="dropdown-footer-text">📋 Format styles • Perfect for any writing style</div>
                            </div>
                        </div>
                    </div>

                    <!-- Paper Colors Dropdown -->
                    <div class="dropdown-container">
                                                    <button class="dropdown-trigger" onclick="toggleDropdown('paperDropdown')" aria-label="Paper colors menu">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-palette text-pink-600 text-sm"></i>
                                    <span>Paper</span>
                                </div>
                                <i class="fas fa-chevron-down text-xs transition-transform duration-200 text-slate-400" id="paperChevron"></i>
                            </button>
                        <div class="dropdown-menu" id="paperDropdown">
                            <div class="dropdown-header">
                                <h3><i class="fas fa-palette"></i> Paper Color Collection</h3>
                            </div>
                            <div class="dropdown-content">
                                <div class="dropdown-section-title">Premium Paper Colors</div>
                                <div class="dropdown-grid cols-2">
                                    <div class="dropdown-item" onclick="changePaperColor('white'); selectPaperColor('white')" title="Pure Snow White">
                                        <div class="paper-swatch paper-color-white"></div>
                                        <div class="flex flex-col items-start">
                                            <span class="font-semibold">Pure White</span>
                                            <span class="text-xs text-slate-500">Classic clean look</span>
                                        </div>
                                    </div>
                                    <div class="dropdown-item" onclick="changePaperColor('mint'); selectPaperColor('mint')" title="Soft Mint Breeze">
                                        <div class="paper-swatch paper-color-mint"></div>
                                        <div class="flex flex-col items-start">
                                            <span class="font-semibold">Mint Fresh</span>
                                            <span class="text-xs text-slate-500">Calm and refreshing</span>
                                        </div>
                                    </div>
                                    <div class="dropdown-item" onclick="changePaperColor('gray'); selectPaperColor('gray')" title="Light Cloud Gray">
                                        <div class="paper-swatch paper-color-gray"></div>
                                        <div class="flex flex-col items-start">
                                            <span class="font-semibold">Cloud Gray</span>
                                            <span class="text-xs text-slate-500">Modern and subtle</span>
                                        </div>
                                    </div>
                                    <div class="dropdown-item" onclick="changePaperColor('cream'); selectPaperColor('cream')" title="Gentle Cream Glow">
                                        <div class="paper-swatch paper-color-cream"></div>
                                        <div class="flex flex-col items-start">
                                            <span class="font-semibold">Cream</span>
                                            <span class="text-xs text-slate-500">Warm and gentle</span>
                                        </div>
                                    </div>
                                    <div class="dropdown-item" onclick="changePaperColor('peach'); selectPaperColor('peach')" title="Delicate Peach Bloom">
                                        <div class="paper-swatch paper-color-peach"></div>
                                        <div class="flex flex-col items-start">
                                            <span class="font-semibold">Peach Bloom</span>
                                            <span class="text-xs text-slate-500">Soft and inviting</span>
                                        </div>
                                    </div>
                                    <div class="dropdown-item" onclick="changePaperColor('rose'); selectPaperColor('rose')" title="Soft Rose Petal">
                                        <div class="paper-swatch paper-color-rose"></div>
                                        <div class="flex flex-col items-start">
                                            <span class="font-semibold">Rose Petal</span>
                                            <span class="text-xs text-slate-500">Elegant and delicate</span>
                                        </div>
                                    </div>
                                    <div class="dropdown-item" onclick="changePaperColor('beige'); selectPaperColor('beige')" title="Warm Ivory Harmony">
                                        <div class="paper-swatch paper-color-beige"></div>
                                        <div class="flex flex-col items-start">
                                            <span class="font-semibold">Warm Beige</span>
                                            <span class="text-xs text-slate-500">Natural harmony</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="dropdown-footer">
                                <div class="dropdown-footer-text">🎨 Premium paper collection • Eye-comfort guaranteed</div>
                            </div>
                        </div>
                    </div>

                    <!-- Font Size Dropdown -->
                    <div class="dropdown-container">
                                                    <button class="dropdown-trigger" onclick="toggleDropdown('sizeDropdown')" aria-label="Font size menu">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-text-height text-purple-600 text-sm"></i>
                                    <span>Size</span>
                                </div>
                                <i class="fas fa-chevron-down text-xs transition-transform duration-200 text-slate-400" id="sizeChevron"></i>
                            </button>
                        <div class="dropdown-menu" id="sizeDropdown">
                            <div class="dropdown-header">
                                <h3><i class="fas fa-text-height"></i> Font Size Control</h3>
                            </div>
                            <div class="dropdown-content">
                                <div class="dropdown-section-title">Text Size Adjustment</div>
                                <div class="size-control">
                                    <button class="size-button bg-gradient-to-br from-red-500 to-red-600 text-white" onclick="decreaseFontSize()" title="Decrease (Ctrl + -)">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <div class="size-display" id="fontSizeDisplayDropdown">1.4rem</div>
                                    <button class="size-button bg-gradient-to-br from-blue-500 to-blue-600 text-white" onclick="increaseFontSize()" title="Increase (Ctrl + +)">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                    <button class="size-button bg-gradient-to-br from-green-500 to-green-600 text-white" onclick="resetFontSize()" title="Reset (Ctrl + 0)">
                                        <i class="fas fa-undo"></i>
                                    </button>
                                </div>
                                
                                <div class="mt-4 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200/50">
                                    <div class="flex items-center gap-2 mb-2">
                                        <i class="fas fa-keyboard text-blue-600 text-sm"></i>
                                        <span class="font-semibold text-blue-800 text-sm">Keyboard Shortcuts</span>
                                    </div>
                                    <div class="space-y-1 text-xs text-blue-700">
                                        <div class="flex justify-between">
                                            <span>Increase size:</span>
                                            <code class="bg-blue-100 px-2 py-1 rounded">Ctrl + Plus</code>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Decrease size:</span>
                                            <code class="bg-blue-100 px-2 py-1 rounded">Ctrl + Minus</code>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Reset to default:</span>
                                            <code class="bg-blue-100 px-2 py-1 rounded">Ctrl + 0</code>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-3 text-center">
                                    <div class="text-xs text-slate-500">Range: 0.8rem - 3.0rem</div>
                                    <div class="text-xs text-slate-400">Default: 1.4rem</div>
                                </div>
                            </div>
                            <div class="dropdown-footer">
                                <div class="dropdown-footer-text">🔤 Dynamic sizing • Responsive design optimized</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex items-center space-x-3">
                    <!-- Share, Save & Clear - Desktop -->
                    <div class="hidden sm:flex items-center space-x-2">
                        <button onclick="shareNote()" class="header-action-btn px-3.5 py-2 bg-gradient-to-br from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white rounded-lg font-medium shadow-md hover:shadow-lg transition-all duration-300 transform hover:scale-105 hover:translate-y-[-1px] flex items-center space-x-1.5" aria-label="Share note">
                            <i class="fas fa-share-alt text-xs"></i>
                            <span class="text-sm">Share</span>
                        </button>
                        
                        <button onclick="saveNote()" class="header-action-btn px-3.5 py-2 bg-gradient-to-br from-emerald-600 to-emerald-700 hover:from-emerald-500 hover:to-emerald-600 text-white rounded-lg font-medium shadow-md hover:shadow-lg transition-all duration-300 transform hover:scale-105 hover:translate-y-[-1px] flex items-center space-x-1.5" aria-label="Save note">
                            <i class="fas fa-save text-xs"></i>
                            <span class="text-sm">Save</span>
                        </button>

                        <button onclick="clearContent()" class="header-action-btn px-3.5 py-2 bg-gradient-to-br from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white rounded-lg font-medium shadow-md hover:shadow-lg transition-all duration-300 transform hover:scale-105 hover:translate-y-[-1px] flex items-center space-x-1.5" aria-label="Clear content" title="Clear all content (recordings in blank mode, text in other modes)">
                            <i class="fas fa-eraser text-xs"></i>
                            <span class="text-sm">Clear</span>
                        </button>
                    </div>

                    <!-- Mobile Tools Button -->
                    <div class="lg:hidden">
                        <button id="mobileToolsBtn" class="group w-10 h-10 bg-gradient-to-br from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/30 transition-all duration-300 transform hover:scale-105" aria-label="Open tools menu">
                                <i class="fas fa-tools text-white text-sm group-hover:scale-110 transition-all duration-300"></i>
                            </button>
                            
                        <!-- Mobile Tools Dropdown -->
                        <div id="mobileToolsDropdown" class="absolute top-16 right-4 bg-white/98 -webkit-backdrop-filter backdrop-blur-xl border border-blue-200/30 rounded-2xl shadow-2xl hidden z-50 w-80 overflow-hidden">
                                <!-- Compact Header -->
                            <div class="bg-gradient-to-r from-blue-600 to-indigo-700 p-4 relative overflow-hidden">
                                <div class="absolute inset-0 bg-gradient-to-br from-white/10 to-transparent"></div>
                                    <div class="relative flex items-center justify-center space-x-2">
                                    <div class="w-6 h-6 bg-white/20 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-tools text-white text-sm"></i>
                                    </div>
                                    <h2 class="font-semibold text-white text-lg">Professional Tools</h2>
                                    </div>
                                </div>

                                <div class="p-4 space-y-4">
                                <!-- Action Buttons Section -->
                                <div class="group/section">
                                    <div class="flex items-center space-x-2 mb-3">
                                        <div class="w-6 h-6 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center">
                                            <i class="fas fa-bolt text-white text-xs"></i>
                                        </div>
                                        <h3 class="text-sm font-semibold text-slate-800">Actions</h3>
                                    </div>
                                    
                                    <div class="grid grid-cols-3 gap-2">
                                        <button onclick="shareNote()" class="px-3 py-3 bg-gradient-to-br from-blue-600 to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105 flex items-center justify-center space-x-1" aria-label="Share note">
                                            <i class="fas fa-share-alt text-sm"></i>
                                            <span class="text-xs font-medium">Share</span>
                                        </button>
                                        
                                        <button onclick="saveNote()" class="px-3 py-3 bg-gradient-to-br from-emerald-600 to-emerald-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105 flex items-center justify-center space-x-1" aria-label="Save note">
                                            <i class="fas fa-save text-sm"></i>
                                            <span class="text-xs font-medium">Save</span>
                                        </button>

                                        <button onclick="clearContent()" class="px-3 py-3 bg-gradient-to-br from-red-600 to-red-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105 flex items-center justify-center space-x-1" aria-label="Clear content" title="Clear content">
                                            <i class="fas fa-eraser text-sm"></i>
                                            <span class="text-xs font-medium">Clear</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Divider -->
                                <div class="h-px bg-gradient-to-r from-transparent via-slate-300 to-transparent"></div>

                                    <!-- Ink Colors Section -->
                                    <div class="group/section">
                                        <div class="flex items-center space-x-2 mb-3">
                                            <div class="w-6 h-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center">
                                                <i class="fas fa-pen text-white text-xs"></i>
                                            </div>
                                            <h3 class="text-sm font-semibold text-slate-800">Ink Colors</h3>
                                        </div>
                                        
                                        <div class="flex justify-center space-x-3">
                                            <button onclick="changeColor('#1e40af')" class="group w-8 h-8 rounded-lg bg-gradient-to-br from-blue-600 to-blue-800 shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-110 border border-white" aria-label="Blue Ink">
                                                <i class="fas fa-droplet text-white text-xs"></i>
                                            </button>
                                            
                                            <button onclick="changeColor('#1e293b')" class="group w-8 h-8 rounded-lg bg-gradient-to-br from-slate-700 to-slate-900 shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-110 border border-white" aria-label="Black Ink">
                                                <i class="fas fa-droplet text-white text-xs"></i>
                                            </button>
                                            
                                            <button onclick="changeColor('#b91c1c')" class="group w-8 h-8 rounded-lg bg-gradient-to-br from-red-600 to-red-800 shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-110 border border-white" aria-label="Red Ink">
                                                <i class="fas fa-droplet text-white text-xs"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Divider -->
                                    <div class="h-px bg-gradient-to-r from-transparent via-slate-300 to-transparent"></div>

                                    <!-- Paper Format Section -->
                                    <div class="group/section">
                                        <div class="flex items-center space-x-2 mb-3">
                                            <div class="w-6 h-6 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-lg flex items-center justify-center">
                                                <i class="fas fa-file text-white text-xs"></i>
                                            </div>
                                            <h3 class="text-sm font-semibold text-slate-800">Paper Format</h3>
                                        </div>
                                        
                                        <div class="grid grid-cols-2 gap-2">
                                            <button onclick="changeStyle('lined')" class="group px-3 py-2 bg-gradient-to-br from-blue-600 to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105" aria-label="Lined paper">
                                                <div class="flex flex-col items-center space-y-1">
                                                    <i class="fas fa-grip-lines text-sm"></i>
                                                    <span class="text-xs font-medium">LINED</span>
                                                </div>
                                            </button>
                                            
                                            <button onclick="changeStyle('grid')" class="group px-3 py-2 bg-gradient-to-br from-slate-600 to-slate-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105" aria-label="Grid paper">
                                                <div class="flex flex-col items-center space-y-1">
                                                    <i class="fas fa-th text-sm"></i>
                                                    <span class="text-xs font-medium">GRID</span>
                                                </div>
                                            </button>
                                            
                                            <button onclick="changeStyle('dots')" class="group px-3 py-2 bg-gradient-to-br from-indigo-600 to-indigo-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105" aria-label="Dotted paper">
                                                <div class="flex flex-col items-center space-y-1">
                                                    <i class="fas fa-braille text-sm"></i>
                                                    <span class="text-xs font-medium">DOTS</span>
                                                </div>
                                            </button>
                                            
                                            <button onclick="changeStyle('blank')" class="group px-3 py-2 bg-gradient-to-br from-purple-600 to-purple-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105" aria-label="Blank paper">
                                                <div class="flex flex-col items-center space-y-1">
                                                    <i class="fas fa-square text-sm"></i>
                                                    <span class="text-xs font-medium">BLANK</span>
                                                </div>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Divider -->
                                    <div class="h-px bg-gradient-to-r from-transparent via-slate-300 to-transparent"></div>

                                    <!-- Paper Colors Section -->
                                    <div class="group/section">
                                        <div class="flex items-center space-x-2 mb-3">
                                            <div class="w-6 h-6 bg-gradient-to-br from-pink-500 to-rose-600 rounded-lg flex items-center justify-center">
                                                <i class="fas fa-palette text-white text-xs"></i>
                                            </div>
                                            <h3 class="text-sm font-semibold text-slate-800">Paper Colors</h3>
                                        </div>
                                        
                                        <div class="grid grid-cols-4 gap-2">
                                            <button onclick="changePaperColor('white')" class="group w-8 h-8 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-110 border border-slate-300 paper-color-white" aria-label="White paper"></button>
                                            
                                            <button onclick="changePaperColor('mint')" class="group w-8 h-8 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-110 border border-emerald-300 paper-color-mint" aria-label="Mint paper"></button>
                                            
                                            <button onclick="changePaperColor('gray')" class="group w-8 h-8 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-110 border border-slate-400 paper-color-gray" aria-label="Gray paper"></button>
                                            
                                            <button onclick="changePaperColor('cream')" class="group w-8 h-8 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-110 border border-yellow-400 paper-color-cream" aria-label="Cream paper"></button>
                                            
                                            <button onclick="changePaperColor('peach')" class="group w-8 h-8 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-110 border border-orange-400 paper-color-peach" aria-label="Peach paper"></button>
                                            
                                            <button onclick="changePaperColor('rose')" class="group w-8 h-8 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-110 border border-pink-400 paper-color-rose" aria-label="Rose paper"></button>
                                            
                                            <button onclick="changePaperColor('beige')" class="group w-8 h-8 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-110 border border-amber-400 paper-color-beige" aria-label="Beige paper"></button>
                                        </div>
                                    </div>

                                <!-- Divider -->
                                <div class="h-px bg-gradient-to-r from-transparent via-slate-300 to-transparent"></div>

                                <!-- Font Size Section -->
                                <div class="group/section">
                                    <div class="flex items-center space-x-2 mb-3">
                                        <div class="w-6 h-6 bg-gradient-to-br from-purple-500 to-violet-600 rounded-lg flex items-center justify-center">
                                            <i class="fas fa-text-height text-white text-xs"></i>
                                </div>
                                        <h3 class="text-sm font-semibold text-slate-800">Font Size</h3>
                </div>

                                    <div class="flex items-center justify-center space-x-3">
                                        <button onclick="decreaseFontSize()" class="group w-10 h-10 bg-gradient-to-br from-slate-600 to-slate-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105 flex items-center justify-center" aria-label="Decrease font size">
                                            <i class="fas fa-minus text-sm"></i>
                                        </button>

                                        <div id="fontSizeDisplayMobile" class="px-3 py-2 bg-slate-100 text-slate-800 rounded-lg text-sm font-medium border border-slate-300 min-w-16 text-center">
                                            1.4rem
            </div>
        
                                        <button onclick="increaseFontSize()" class="group w-10 h-10 bg-gradient-to-br from-blue-600 to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105 flex items-center justify-center" aria-label="Increase font size">
                                            <i class="fas fa-plus text-sm"></i>
                                        </button>
    </div>

                                    <div class="flex justify-center mt-2">
                                        <button onclick="resetFontSize()" class="group px-4 py-2 bg-gradient-to-br from-green-600 to-green-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105 flex items-center space-x-2" aria-label="Reset font size">
                                            <i class="fas fa-undo text-xs"></i>
                                            <span class="text-xs font-medium">Reset</span>
                    </button>
                </div>
            </div>
        </div>
                            </div>
                        </div>
                            </div>
                        </div>
        </nav>
        
        <!-- Paper Edge Effect -->
        <div class="h-1 bg-gradient-to-r from-transparent via-blue-100 to-transparent opacity-60"></div>
                    </div>
                    
    <!-- Paper Workspace Container -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">




        <!-- The Notebook Paper -->
        <main id="notebook-paper" class="rounded-lg w-full">
            <!-- Date and Time Header -->
            <div id="currentDateTime" class="font-patrick text-gray-600 text-center pt-6 pb-2 text-2xl font-semibold" dir="ltr" style="line-height: 1.5em;">
                <!-- Date and time will appear here -->
            </div>
            
            <!-- Writing Area -->
            <div id="editor" contenteditable="true" class="font-patrick text-gray-800" role="textbox" aria-label="Text editor for writing notes" aria-multiline="true" tabindex="0"></div>
        </main>
        
        <!-- Status Message -->
        <div id="status" class="text-center mt-4 p-2 text-sm text-slate-600 font-medium bg-white/90 backdrop-blur-sm rounded-lg border border-slate-200 shadow-md transition-all duration-300 opacity-0"></div>
        
        <!-- Voice Status Info -->
        <div id="voiceInfo" class="text-center mt-2 p-3 text-xs text-slate-500 bg-slate-50 rounded-lg border border-slate-100 shadow-sm hidden">
            <div class="flex items-center justify-center space-x-2" dir="ltr">
                <i class="fas fa-info-circle text-blue-500"></i>
                <span id="voiceInfoText">Voice recognition is ready for use</span>
            </div>
        </div>
        
    </div>

    <!-- Modern Professional Voice Button -->
    <div id="fixedVoiceButton" class="fixed bottom-6 right-6 z-50">
        <button id="whatsappVoiceBtn" 
                class="group relative w-18 h-18 rounded-full flex items-center justify-center border-2 border-white/30 transition-all duration-400 transform hover:scale-105"
                aria-label="Professional voice recording - Click to start/stop">
            
            <!-- Glassmorphism layers -->
            <div class="absolute inset-0 bg-white/10 rounded-full blur-sm"></div>
            <div class="absolute inset-1 bg-gradient-to-br from-white/20 to-transparent rounded-full"></div>
            
            <!-- Main microphone icon -->
            <i id="whatsappMicIcon" class="fas fa-microphone text-white text-2xl relative z-10"></i>
            
            <!-- Professional sound waves (hidden by default, shown when recording) -->
            <div class="sound-waves absolute inset-0 opacity-0 transition-opacity duration-300">
                <div class="sound-wave absolute"></div>
                <div class="sound-wave absolute"></div>
                <div class="sound-wave absolute"></div>
            </div>
        </button>
        
        <!-- Advanced Recording indicator -->
        <div id="recordingIndicator" class="absolute -top-2 -right-2 w-7 h-7 rounded-full opacity-0 transition-all duration-300 flex items-center justify-center">
            <div class="indicator-dot w-3 h-3 rounded-full"></div>
        </div>
        
        <!-- Professional Recording status -->
        <div id="recordingStatus" class="absolute bottom-full right-0 mb-4 text-white text-sm px-5 py-3 rounded-xl opacity-0 transition-all duration-400 whitespace-nowrap">
            <!-- Tooltip arrow -->
            <div class="absolute -bottom-2 right-6 w-4 h-4 bg-slate-900 transform rotate-45 border border-white/10"></div>
            
            <div class="flex items-center space-x-3">
                <!-- Animated status icon -->
                <span class="status-icon inline-block w-3 h-3 rounded-full"></span>
                
                <!-- Recording text and timer -->
            <div class="flex items-center space-x-2">
                    <span id="recordingStatusText" class="font-semibold">Recording...</span>
                    
                    <!-- Voice level indicator -->
                    <div class="voice-level-container">
                        <div class="voice-level-bar"></div>
                        <div class="voice-level-bar"></div>
                        <div class="voice-level-bar"></div>
                        <div class="voice-level-bar"></div>
                        <div class="voice-level-bar"></div>
                    </div>
                </div>
            </div>
            
            <!-- Language indicator -->
            <div class="mt-1 text-xs text-white/70 flex items-center">
                <i class="fas fa-globe-americas mr-1"></i>
                <span id="languageIndicator">Arabic/English Auto-Detection</span>
            </div>
        </div>
        
        <!-- Accessibility hint -->
        <div class="absolute -bottom-12 left-1/2 transform -translate-x-1/2 text-xs text-slate-500 opacity-0 hover:opacity-100 transition-opacity duration-300 whitespace-nowrap">
            Professional Voice Recording
        </div>
    </div>

    <!-- Merge Control Bar -->
    <div id="mergeControlBar">
        <div class="merge-control-content">
            <div class="merge-info">
                <div class="merge-counter">
                    <i class="fas fa-layer-group"></i>
                    <span id="mergeCount">0</span>
                    <span>text(s) selected for merging</span>
                </div>
                <div class="merge-preview" id="mergePreview">
                    Select text blocks to merge them together...
                </div>
            </div>
            
            <div class="merge-actions">
                <button class="merge-action-btn merge-clear-btn" onclick="clearMergeSelection()">
                    <i class="fas fa-times"></i>
                    Clear
                </button>
                <button class="merge-action-btn merge-execute-btn" onclick="executeMerge()" id="mergeExecuteBtn" disabled>
                    <i class="fas fa-magic"></i>
                    Merge Texts
                </button>
                <button class="merge-action-btn merge-cancel-btn" onclick="hideMergeBar()">
                    <i class="fas fa-times-circle"></i>
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Professional Footer -->
    <footer class="footer mt-12 bg-gradient-to-br from-blue-50 via-indigo-50 to-slate-50 border-t border-blue-200/30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center">
                <div class="flex items-center justify-center mb-4">
                    <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-blue-700 rounded-lg flex items-center justify-center shadow-md shadow-blue-500/30">
                        <i class="fas fa-feather-alt text-white text-sm"></i>
                    </div>
                    <span class="ml-3 text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-slate-800 via-blue-800 to-blue-900 font-caveat">Script.ai</span>
                </div>
                
                <div class="copyright">
                    <p class="text-sm text-slate-600 font-patrick leading-relaxed">
                        <span class="inline-flex items-center space-x-1">
                            <i class="fas fa-terminal text-blue-500 text-xs"></i>
                            <span class="font-mono text-xs bg-slate-100 px-2 py-1 rounded border">SYS_MSG:</span>
                        </span>
                        All rights reserved ©  <span id="year" class="font-semibold text-blue-700"> 2025  </span> 
                        <a href="https://moibrahim0115.github.io/cv/?" target="_blank" rel="noopener noreferrer" 
                           class="text-blue-600 hover:text-blue-800 font-medium underline decoration-2 underline-offset-2 hover:decoration-blue-600 transition-colors">
                              Mohamed Ibrahim 
                        </a> 
                        <span class="inline-flex items-center space-x-1 ml-1">
                            <span class="text-slate-400">//</span>
                            <span class="font-mono text-xs bg-emerald-100 px-2 py-1 rounded border text-emerald-700">END_OF_LINE</span>
                        </span>
                    </p>
                     
                    <!-- Voice Tutorial Section -->
                    <div class="voice-tutorial mt-6 text-left">
                        <h3><i class="fas fa-microphone-alt mr-2"></i> Voice Recording Usage Guide</h3>
                        <ul>
                            <li>
                                <div class="icon"><i class="fas fa-mouse-pointer text-xs"></i></div>
                                <div>Click the microphone button once to start recording</div>
                            </li>
                            <li>
                                <div class="icon"><i class="fas fa-hand-pointer text-xs"></i></div>
                                <div>Click the button again to stop recording (All devices)</div>
                            </li>
                            <li>
                                <div class="icon"><i class="fas fa-language text-xs"></i></div>
                                <div>System automatically switches between Arabic and English</div>
                            </li>
                            <li>
                                <div class="icon"><i class="fas fa-spell-check text-xs"></i></div>
                                <div>Intelligent spell checker corrects errors during writing</div>
                            </li>
                            <li>
                                <div class="icon"><i class="fas fa-clock text-xs"></i></div>
                                <div>Recording timer shows duration while recording</div>
                            </li>
                            <li>
                                <div class="icon"><i class="fas fa-text-height text-xs"></i></div>
                                <div>Use Ctrl + Plus/Minus to adjust font size, or use the buttons in toolbar</div>
                            </li>
                            <li>
                                <div class="icon"><i class="fas fa-keyboard text-xs"></i></div>
                                <div>Keyboard shortcuts: Ctrl + (increase), Ctrl - (decrease), Ctrl 0 (reset)</div>
                            </li>
                            <li>
                                <div class="icon"><i class="fas fa-eraser text-xs"></i></div>
                                <div>Clear button: Removes recordings in blank mode, or text in other paper modes</div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer Wave Effect -->
        <div class="h-1 bg-gradient-to-r from-blue-200 via-indigo-300 to-blue-200 opacity-50"></div>
    </footer>

    <!-- Typing Sound - Local/Safe Audio -->
    <!-- <audio id="typing-sound" src="./sounds/typing.mp3" preload="auto"></audio> -->
    
    <!-- Font Awesome Icons - Official CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <script>
        // State management
        let currentColor = '#1e293b';
        let currentPaperColor = 'white';
        let recognition = null;
        let currentLanguage = 'ar-SA'; // Default to Arabic
        let isRecording = false;
        let currentFontSize = 1.4; // Default font size in rem
        
        // WhatsApp style recording state
        let isWhatsAppRecording = false;
        let recordingStartTime = null;
        let recordingTimer = null;
        let recordingDuration = 0;
        let isToggleMode = true; // New toggle mode flag

        // DOM Elements - Cached for better performance
        const editor = document.getElementById('editor');
        const statusDiv = document.getElementById('status');
        const typingSound = document.getElementById('typing-sound');
        const voiceInfo = document.getElementById('voiceInfo');
        const dateTimeElement = document.getElementById('currentDateTime');
        
        // WhatsApp style voice button elements
        const whatsappVoiceBtn = document.getElementById('whatsappVoiceBtn');
        const whatsappMicIcon = document.getElementById('whatsappMicIcon');
        const recordingIndicator = document.getElementById('recordingIndicator');
        const recordingStatus = document.getElementById('recordingStatus');
        const recordingStatusText = document.getElementById('recordingStatusText');
        
        // Enhanced Auto-detect language from voice input
        function detectLanguageFromVoice(transcript) {
            // Enhanced Arabic character detection including all ranges
            const arabicRegex = /[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;
            
            // Additional checks for mixed content
            const arabicCharCount = (transcript.match(arabicRegex) || []).length;
            const totalChars = transcript.replace(/\s+/g, '').length;
            const englishLetters = transcript.match(/[a-zA-Z]/g) || [];
            
            // Calculate Arabic content percentage
            const arabicPercentage = totalChars > 0 ? (arabicCharCount / totalChars) * 100 : 0;
            
            // Determine language based on content analysis
            if (arabicPercentage > 30) {
                return 'ar-SA';
            } else if (englishLetters.length > 3 && arabicPercentage < 10) {
                return 'en-US';
            } else if (arabicCharCount > 0) {
                return 'ar-SA'; // Default to Arabic if any Arabic characters found
            } else {
                return 'en-US'; // Default to English for other cases
            }
        }

        // Auto-switch language based on detected content
        function autoSwitchLanguage(transcript) {
            const detectedLanguage = detectLanguageFromVoice(transcript);
            if (detectedLanguage !== currentLanguage) {
                currentLanguage = detectedLanguage;
                const langName = currentLanguage === 'ar-SA' ? 'Arabic' : 'English';
                showStatus(`🎤 Automatically switched to ${langName} recognition`);
                
                // Update recognition language if active
                if (recognition) {
                    recognition.lang = currentLanguage;
                }
            }
        }

        // Format recording duration
        function formatDuration(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Enhanced Recording Timer with Visual Feedback
        function updateRecordingTimer() {
            if (isWhatsAppRecording && recordingStartTime) {
                recordingDuration = Math.floor((Date.now() - recordingStartTime) / 1000);
                
                // Enhanced status updates
                let statusText = 'Recording';
                if (recordingDuration < 1) {
                    statusText = 'Initializing';
                } else if (recordingDuration < 3) {
                    statusText = 'Listening';
                } else {
                    statusText = 'Recording';
                }
                
                updateRecordingStatusText(statusText, recordingDuration);
                
                // Visual feedback based on duration
                updateRecordingVisualFeedback(recordingDuration);
                
                // Auto-stop after 10 minutes with warnings
                if (recordingDuration >= 600) { // 10 minutes
                    stopWhatsAppRecording();
                    showStatus("⏰ Recording automatically stopped after 10 minutes for optimal performance");
                } else if (recordingDuration >= 540) { // 9 minutes warning
                    showStatus("⚠️ Recording will auto-stop in 1 minute");
                } else if (recordingDuration >= 480) { // 8 minutes warning
                    showStatus("⚠️ Recording will auto-stop in 2 minutes");
                }
            }
        }

        // Update Visual Feedback During Recording
        function updateRecordingVisualFeedback(duration) {
            // Change button intensity based on duration
            const button = document.getElementById('whatsappVoiceBtn');
            if (button && button.classList.contains('recording')) {
                if (duration > 30) {
                    button.style.filter = 'hue-rotate(10deg) brightness(1.1)';
                }
                if (duration > 60) {
                    button.style.filter = 'hue-rotate(20deg) brightness(1.2)';
                }
            }
        }





        // Toggle WhatsApp style recording
        function toggleWhatsAppRecording() {
            if (isWhatsAppRecording) {
                stopWhatsAppRecording();
            } else {
                startWhatsAppRecording();
            }
        }

        // Start Professional Voice Recording with Smart Page Management
        function startWhatsAppRecording() {
            if (!recognition) {
                recognition = setupRecognition();
                if (!recognition) {
                    showStatus("🚫 Voice recording not supported on this device");
                    return;
                }
            }
            
            // Force switch to blank paper for recording (RECORDING IS ONLY ALLOWED IN BLANK MODE)
            const currentPaper = document.getElementById('notebook-paper');
            const currentPaperClass = currentPaper.className;
            
            // Check if we're not already in blank mode
            if (!currentPaperClass.includes('blank-paper-mode')) {
                // Show notification about switching to blank mode
                showStatus("📄 Switching to blank mode - Recording is only available in blank paper", 'info');
                
                // Auto-save current content before switching
                saveNote();
                
                // Switch to blank paper automatically
                setTimeout(() => {
                    changeStyle('blank');
                    // Wait for transition, then start recording
                    setTimeout(() => {
                        continueRecordingSetup();
                    }, 300);
                }, 800);
                return;
            }
            
            // We're already in blank mode, proceed with recording
            continueRecordingSetup();
        }

        // Continue with recording setup after ensuring blank mode
        function continueRecordingSetup() {
            isWhatsAppRecording = true;
            recordingStartTime = Date.now();
            recordingDuration = 0;
            
            // Smart page preparation for recording (only in blank mode)
            preparePageForRecording();
            
            // Enhanced UI Updates
            whatsappVoiceBtn.classList.add('recording');
            recordingIndicator.classList.add('show');
            recordingStatus.classList.add('show');
            
            // Update recording text with professional styling
            updateRecordingStatusText('Initializing...', 0);
            
            // Start timer with enhanced updates
            recordingTimer = setInterval(updateRecordingTimer, 100); // More frequent updates
            
            // Auto-detect language or start with Arabic
            const hasArabicText = /[\u0600-\u06FF]/.test(editor.textContent);
            recognition.lang = hasArabicText ? 'ar-SA' : 'ar-SA'; // Default to Arabic
            currentLanguage = recognition.lang;
            
            // Update language indicator
            updateLanguageIndicator(currentLanguage);
            
            // Add visual feedback
            addRecordingVisualEffects();
            
            try {
                recognition.start();
                // Enhanced status messages
                setTimeout(() => {
                    if (isWhatsAppRecording) {
                        showStatus("🎙️ Recording session started - Speak clearly, transcriptions will appear below");
                    }
                }, 500);
            } catch (e) {
                console.error("Voice recognition start error:", e);
                showStatus(`🚫 Recording error: ${e.message}`);
                stopWhatsAppRecording();
            }
        }

        // Prepare Page for Recording Session (BLANK MODE ONLY)
        function preparePageForRecording() {
            // Auto-save current content to appropriate storage (non-blank content)
            saveNoteToRegularStorage();
            
            // Load existing blank content (previous recordings) or clear
            loadBlankContent();
            
            // Ensure page is in blank mode
            const paper = document.getElementById('notebook-paper');
            paper.className = 'rounded-lg w-full blank-paper-mode';
            
            // Apply recording session styles
            editor.style.padding = '2rem';
            editor.style.lineHeight = '1.8';
            editor.style.minHeight = '100vh';
            editor.style.background = 'transparent';
            
            // Check if we need to add a new session header
            const existingHeader = document.querySelector('.recording-session-header');
            if (!existingHeader) {
                // Add professional recording session header
                const timestamp = new Date();
                const sessionHeader = createRecordingSessionHeader(timestamp);
                editor.appendChild(sessionHeader);
            }
            
            // Check if transcription container exists, create if not
            let transcriptionContainer = document.getElementById('transcriptionContainer');
            if (!transcriptionContainer) {
                transcriptionContainer = document.createElement('div');
                transcriptionContainer.id = 'transcriptionContainer';
                transcriptionContainer.className = 'transcription-container';
                editor.appendChild(transcriptionContainer);
            }
            
            // Set cursor position at the end of container
            const range = document.createRange();
            const selection = window.getSelection();
            range.selectNodeContents(transcriptionContainer);
            range.collapse(false); // Move to end
            selection.removeAllRanges();
            selection.addRange(range);
        }

        // Create Professional Recording Session Header
        function createRecordingSessionHeader(timestamp) {
            const header = document.createElement('div');
            header.className = 'recording-session-header';
            header.contentEditable = false;
            
            const dateStr = timestamp.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            const timeStr = timestamp.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            });
            
            header.innerHTML = `
                <div class="session-header-content">
                    <div class="session-title">
                        <i class="fas fa-microphone-alt mr-2"></i>
                        Voice Recording Session
                    </div>
                    <div class="session-datetime">
                        <i class="fas fa-calendar-alt mr-1"></i>
                        ${dateStr}
                        <span class="mx-2">•</span>
                        <i class="fas fa-clock mr-1"></i>
                        ${timeStr}
                    </div>
                </div>
                <div class="session-divider"></div>
                <div class="session-instructions">
                    <i class="fas fa-info-circle mr-2"></i>
                    <span>Your transcriptions will appear below in real-time...</span>
                </div>
            `;
            
            return header;
        }

        // Enhanced Recording Status Updates
        function updateRecordingStatusText(baseText, duration) {
            const formattedTime = formatDuration(duration);
            const statusText = `${baseText} ${formattedTime}`;
            
            if (recordingStatusText) {
                recordingStatusText.innerHTML = `
                    <span class="recording-pulse">●</span> 
                    ${statusText}
                `;
            }
        }

        // Update Language Indicator
        function updateLanguageIndicator(langCode) {
            const languageIndicator = document.getElementById('languageIndicator');
            if (languageIndicator) {
                const languages = {
                    'ar-SA': 'Arabic - العربية',
                    'en-US': 'English - EN',
                    'auto': 'Auto-Detection'
                };
                languageIndicator.textContent = languages[langCode] || 'Multi-Language';
            }
        }

        // Add Visual Effects During Recording
        function addRecordingVisualEffects() {
            // Add subtle screen dim effect
            const overlay = document.createElement('div');
            overlay.id = 'recordingOverlay';
            overlay.className = 'fixed inset-0 bg-black/5 backdrop-blur-sm z-40 pointer-events-none opacity-0 transition-opacity duration-500';
            document.body.appendChild(overlay);
            
            setTimeout(() => {
                overlay.style.opacity = '1';
            }, 100);
        }

        // Remove Visual Effects
        function removeRecordingVisualEffects() {
            const overlay = document.getElementById('recordingOverlay');
            if (overlay) {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    overlay.remove();
                }, 500);
            }
        }

        // Stop Professional Voice Recording
        function stopWhatsAppRecording() {
            isWhatsAppRecording = false;
            
            // Clear timer
            if (recordingTimer) {
                clearInterval(recordingTimer);
                recordingTimer = null;
            }
            
            // Enhanced UI cleanup with smooth transitions
            const button = document.getElementById('whatsappVoiceBtn');
            if (button) {
                button.classList.remove('recording');
                button.style.filter = ''; // Reset any visual effects
            }
            
            // Smooth hiding of indicators
            recordingIndicator.classList.remove('show');
            setTimeout(() => {
            recordingStatus.classList.remove('show');
            }, 150);
            
            // Remove visual effects
            removeRecordingVisualEffects();
            
            // Stop recognition with enhanced error handling
            if (recognition && isRecording) {
                try {
                    recognition.stop();
                    isRecording = false;
                } catch (e) {
                    console.error("Error stopping recognition:", e);
                    showStatus("⚠️ Recording stopped with minor technical issue");
                }
            }
            
            // Create session completion summary
            const sessionSummary = createSessionSummary();
            if (sessionSummary) {
                // Add summary to transcription container if it exists, otherwise to editor
                const transcriptionContainer = document.getElementById('transcriptionContainer');
                if (transcriptionContainer) {
                    transcriptionContainer.appendChild(sessionSummary);
                } else {
                    editor.appendChild(sessionSummary);
                }
            }
            
            // Enhanced completion feedback with session statistics
            if (recordingDuration > 0) {
                const minutes = Math.floor(recordingDuration / 60);
                const seconds = recordingDuration % 60;
                let durationText = '';
                
                if (minutes > 0) {
                    durationText = `${minutes}m ${seconds}s`;
                } else {
                    durationText = `${seconds}s`;
                }
                
                // Count transcription blocks for statistics
                const transcriptionBlocks = editor.querySelectorAll('.transcription-block');
                const blockCount = transcriptionBlocks.length;
                
                if (recordingDuration < 3) {
                    showStatus("⚡ Quick recording session completed - Consider longer recordings for better accuracy");
                } else if (recordingDuration > 120) {
                    showStatus(`✅ Extended recording session completed (${durationText}) - ${blockCount} transcription${blockCount !== 1 ? 's' : ''} captured`);
                } else {
                    showStatus(`✅ Professional recording session completed (${durationText}) - ${blockCount} transcription${blockCount !== 1 ? 's' : ''} processed successfully`);
                }
            } else {
                showStatus("ℹ️ Recording session ended - No speech detected during this session");
            }
            
            // Reset recording duration
            recordingDuration = 0;
            recordingStartTime = null;
            
            // Auto-save the session
            saveNote();
        }

        // Create Session Completion Summary
        function createSessionSummary() {
            const transcriptionBlocks = editor.querySelectorAll('.transcription-block');
            if (transcriptionBlocks.length === 0) return null;
            
            // Count languages used
            const arabicBlocks = editor.querySelectorAll('.arabic-transcription').length;
            const englishBlocks = editor.querySelectorAll('.english-transcription').length;
            
            const summary = document.createElement('div');
            summary.className = 'session-summary';
            summary.contentEditable = false;
            
            const endTime = new Date();
            const endTimeStr = endTime.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            });
            
            summary.innerHTML = `
                <div class="summary-content">
                    <div class="summary-title">
                        <i class="fas fa-flag-checkered mr-2"></i>
                        Recording Session Completed
                    </div>
                    <div class="summary-stats">
                        <div class="stat-item">
                            <i class="fas fa-clock"></i>
                            <span>Ended: ${endTimeStr}</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-comment-dots"></i>
                            <span>${transcriptionBlocks.length} Transcription${transcriptionBlocks.length !== 1 ? 's' : ''}</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-globe"></i>
                            <span>${arabicBlocks} Arabic • ${englishBlocks} English</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-stopwatch"></i>
                            <span>Duration: ${formatDuration(recordingDuration)}</span>
                        </div>
                    </div>
                </div>
                <div class="summary-divider"></div>
            `;
            
            return summary;
        }

        // =================== MERGE FUNCTIONALITY ===================
        
        let selectedBlocksForMerge = [];
        
        // Toggle Block Selection for Merge
        function toggleBlockSelection(button) {
            const block = button.closest('.transcription-block');
            const blockId = block.getAttribute('data-block-id');
            
            if (selectedBlocksForMerge.includes(blockId)) {
                // Deselect
                selectedBlocksForMerge = selectedBlocksForMerge.filter(id => id !== blockId);
                block.classList.remove('selected-for-merge');
                button.classList.remove('selected');
                button.innerHTML = '<i class="fas fa-plus-circle"></i><span>Select</span>';
            } else {
                // Select
                selectedBlocksForMerge.push(blockId);
                block.classList.add('selected-for-merge');
                button.classList.add('selected');
                button.innerHTML = '<i class="fas fa-check-circle"></i><span>Selected</span>';
            }
            
            updateMergeInterface();
        }

        // Update Merge Interface
        function updateMergeInterface() {
            const mergeBar = document.getElementById('mergeControlBar');
            const mergeCount = document.getElementById('mergeCount');
            const mergePreview = document.getElementById('mergePreview');
            const executeBtn = document.getElementById('mergeExecuteBtn');
            
            const count = selectedBlocksForMerge.length;
            mergeCount.textContent = count;
            
            if (count > 0) {
                mergeBar.classList.add('show');
                executeBtn.disabled = count < 2;
                
                // Generate preview text
                const previewTexts = selectedBlocksForMerge.map(blockId => {
                    const block = document.querySelector(`[data-block-id="${blockId}"]`);
                    const content = block.querySelector('.transcription-content').textContent;
                    return content.substring(0, 50) + (content.length > 50 ? '...' : '');
                });
                
                mergePreview.textContent = previewTexts.join(' | ');
            } else {
                mergeBar.classList.remove('show');
            }
        }

        // Clear Merge Selection
        function clearMergeSelection() {
            selectedBlocksForMerge.forEach(blockId => {
                const block = document.querySelector(`[data-block-id="${blockId}"]`);
                if (block) {
                    block.classList.remove('selected-for-merge');
                    const button = block.querySelector('.merge-btn');
                    button.classList.remove('selected');
                    button.innerHTML = '<i class="fas fa-plus-circle"></i><span>Select</span>';
                }
            });
            
            selectedBlocksForMerge = [];
            updateMergeInterface();
        }

        // Hide Merge Bar
        function hideMergeBar() {
            clearMergeSelection();
        }

        // Execute Merge Operation
        function executeMerge() {
            if (selectedBlocksForMerge.length < 2) {
                showStatus("⚠️ Please select at least 2 text blocks to merge");
                return;
            }
            
            // Get selected blocks data
            const blocksData = selectedBlocksForMerge.map(blockId => {
                const block = document.querySelector(`[data-block-id="${blockId}"]`);
                return {
                    id: blockId,
                    content: block.querySelector('.transcription-content').textContent,
                    language: block.getAttribute('data-language'),
                    timestamp: new Date(block.getAttribute('data-timestamp')),
                    element: block
                };
            }).sort((a, b) => a.timestamp - b.timestamp); // Sort by timestamp
            
            // Create merged block
            const mergedBlock = createMergedBlock(blocksData);
            
            // Insert merged block in the appropriate location
            const transcriptionContainer = document.getElementById('transcriptionContainer');
            const lastBlock = blocksData[blocksData.length - 1].element;
            
            if (transcriptionContainer && transcriptionContainer.contains(lastBlock)) {
                // If we're in a recording session, add to container
                lastBlock.after(mergedBlock);
            } else {
                // Otherwise, add after the last block normally
                lastBlock.after(mergedBlock);
            }
            
            // Remove original blocks or mark them as merged
            blocksData.forEach(blockData => {
                blockData.element.style.opacity = '0.3';
                blockData.element.style.pointerEvents = 'none';
                const header = blockData.element.querySelector('.transcription-header');
                header.innerHTML = `
                    <div class="transcription-meta">
                        <span style="color: #dc2626; font-weight: 600;">
                            <i class="fas fa-archive"></i>
                            Merged into combined text below
                        </span>
                    </div>
                `;
            });
            
            // Clear selection and hide merge bar
            selectedBlocksForMerge = [];
            updateMergeInterface();
            
            // Scroll to merged block
            mergedBlock.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            // Show success message
            showStatus(`✅ Successfully merged ${blocksData.length} text blocks into one combined text`);
        }

        // Create Merged Block
        function createMergedBlock(blocksData) {
            const block = document.createElement('div');
            block.className = 'transcription-block merged-transcription';
            block.setAttribute('data-block-id', `merged-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`);
            
            const languages = [...new Set(blocksData.map(b => b.language))];
            const isMultiLang = languages.length > 1;
            const primaryLang = blocksData[0].language;
            
            block.setAttribute('data-language', isMultiLang ? 'mixed' : primaryLang);
            block.setAttribute('data-timestamp', new Date().toISOString());
            
            const timestamp = new Date();
            const timeStr = timestamp.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            });
            
            const dateStr = timestamp.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric'
            });
            
            // Combine content with proper spacing and direction
            const combinedContent = blocksData.map(blockData => {
                const lang = blockData.language;
                return `<div class="${lang === 'ar' ? 'rtl-content' : 'ltr-content'}">${blockData.content}</div>`;
            }).join('<div class="merge-separator"></div>');
            
            block.innerHTML = `
                <div class="transcription-header">
                    <div class="transcription-meta">
                        <span class="transcription-time">
                            <i class="fas fa-clock"></i>
                            ${timeStr}
                        </span>
                        <span class="transcription-date">
                            <i class="fas fa-calendar"></i>
                            ${dateStr}
                        </span>
                        <span class="transcription-language">
                            <i class="fas fa-layer-group"></i>
                            Merged (${blocksData.length} texts)
                        </span>
                        <span class="transcription-languages">
                            <i class="fas fa-globe"></i>
                            ${isMultiLang ? 'Arabic + English' : (primaryLang === 'ar' ? 'العربية' : 'English')}
                        </span>
                    </div>
                    <div class="transcription-actions">
                        <button class="copy-btn" onclick="copyBlockText(this)" title="Copy merged text">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="edit-btn" onclick="editBlockText(this)" title="Edit merged text">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="split-btn" onclick="splitMergedBlock(this)" title="Split back to original texts">
                            <i class="fas fa-scissors"></i>
                            <span>Split</span>
                        </button>
                    </div>
                </div>
                <div class="transcription-content merged-content" contenteditable="false">
                    ${combinedContent}
                </div>
                <div class="transcription-divider"></div>
            `;
            
            return block;
        }

        // Copy Block Text
        function copyBlockText(button) {
            const block = button.closest('.transcription-block');
            const content = block.querySelector('.transcription-content').textContent;
            
            navigator.clipboard.writeText(content).then(() => {
                showStatus("📋 Text copied to clipboard successfully");
                button.innerHTML = '<i class="fas fa-check"></i>';
                setTimeout(() => {
                    button.innerHTML = '<i class="fas fa-copy"></i>';
                }, 2000);
            }).catch(() => {
                showStatus("❌ Failed to copy text to clipboard");
            });
        }

        // Edit Block Text
        function editBlockText(button) {
            const block = button.closest('.transcription-block');
            const contentDiv = block.querySelector('.transcription-content');
            
            if (contentDiv.contentEditable === 'true') {
                // Save changes
                contentDiv.contentEditable = 'false';
                button.innerHTML = '<i class="fas fa-edit"></i>';
                button.title = 'Edit text';
                showStatus("💾 Text changes saved");
            } else {
                // Enable editing
                contentDiv.contentEditable = 'true';
                contentDiv.focus();
                button.innerHTML = '<i class="fas fa-save"></i>';
                button.title = 'Save changes';
                showStatus("✏️ Editing mode enabled - Click save when done");
            }
        }

        // Initialize the app
        function init() {
            // Set default content
            if (!editor.innerHTML.trim()) {
                editor.innerHTML = '<p>Begin writing your distinguished thoughts here...</p>';
            }
            
            // Set default paper style and color
            const paper = document.getElementById('notebook-paper');
            paper.classList.add('lined', 'paper-white');
            
            // Set default direction and alignment
            editor.style.direction = 'ltr';
            editor.style.textAlign = 'left';
            
            // Load saved content if available
            loadSavedContent();
            
            // Setup event listeners
            setupEventListeners();
            
            // Setup mobile tools dropdown
            setupMobileToolsDropdown();
            
            // Setup voice recognition - Fixed initialization
            recognition = setupRecognition();
            
            // Initialize font size
            updateFontSize();
            
            // Initialize dropdown states
            setTimeout(() => {
                updateDropdownStates();
            }, 100);
            
            // Show welcome message
            showStatus("✨ Distinguished Digital Workspace Ready - With Elegant Arabic & English Recognition");
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Typing events with font detection
            editor.addEventListener('input', handleTyping);
            
            // Initial font check on load
            applyFontBasedOnContent(editor);
            
            // WhatsApp style voice button events - Toggle mode
            if (whatsappVoiceBtn) {
                // Click events for toggle mode
                whatsappVoiceBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    toggleWhatsAppRecording();
                });
                
                // Prevent context menu
                whatsappVoiceBtn.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                });
            }
            
            // Keyboard shortcuts for font size control
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case '+':
                        case '=':
                            e.preventDefault();
                            increaseFontSize();
                            break;
                        case '-':
                            e.preventDefault();
                            decreaseFontSize();
                            break;
                        case '0':
                            e.preventDefault();
                            resetFontSize();
                            break;
                    }
                }
            });
        }
        
        // Detect Arabic text (for styling purposes only)
        function isArabicText(text) {
            const arabicRegex = /[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;
            return arabicRegex.test(text);
        }

        // Apply appropriate font based on content
        function applyFontBasedOnContent(element) {
            const text = element.textContent || element.innerText || '';
            if (isArabicText(text)) {
                element.classList.add('arabic-text');
                element.style.fontFamily = "'Amiri', serif";
                
                // Special handling for main editor
                if (element.id === 'editor') {
                    element.classList.add('arabic-content');
                    // Set RTL direction for Arabic
                    element.style.direction = 'rtl';
                    element.style.textAlign = 'right';
                }
            } else {
                element.classList.remove('arabic-text');
                element.style.fontFamily = "'Patrick Hand', cursive";
                
                // Remove Arabic content class from main editor
                if (element.id === 'editor') {
                    element.classList.remove('arabic-content');
                    // Set LTR direction for English
                    element.style.direction = 'ltr';
                    element.style.textAlign = 'left';
                }
            }
        }

        // Enhanced performance optimization: Debounce function with error handling
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    try {
                        func(...args);
                    } catch (error) {
                        console.error("Debounced function error:", error);
                    }
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Optimized auto-save function with enhanced error handling
        const debouncedSave = debounce(saveNote, 2000);

        // Handle typing with font detection and debouncing
        function handleTyping(event) {
            // Apply appropriate font based on content
            const element = event.target;
            applyFontBasedOnContent(element);
            
            // Auto-save with optimized debouncing
            debouncedSave();
        }
        
        // Change ink color
        function changeColor(color) {
            currentColor = color;
            editor.style.color = color;
            
            // Update status
            const colorNames = {
                '#1e40af': 'Prestigious Sapphire Blue',
                '#1e293b': 'Distinguished Obsidian Black',
                '#b91c1c': 'Executive Crimson Red'
            };
            showStatus(`✍️ Ink elegantly transformed to ${colorNames[color] || 'bespoke hue'} shade`);
        }
        
        // Change page style with separate storage handling
        function changeStyle(style) {
            const paper = document.getElementById('notebook-paper');
            const currentIsBlank = paper.className.includes('blank-paper-mode');
            const switchingToBlank = (style === 'blank');
            
            // Save current content to appropriate storage before switching
            if (currentIsBlank && !switchingToBlank) {
                // Switching FROM blank TO another style - save recordings
                saveBlankContent();
                showStatus("🎙️ Recording session saved", 1500);
            } else if (!currentIsBlank && switchingToBlank) {
                // Switching FROM another style TO blank - save regular content
                saveNoteToRegularStorage();
                showStatus("💾 Content saved", 1500);
            } else if (!currentIsBlank && !switchingToBlank) {
                // Switching between non-blank styles - save regular content
                saveNoteToRegularStorage();
            }
            // No need to save when staying in blank mode
            
            // Update paper style
            paper.className = 'rounded-lg';
            if (switchingToBlank) {
                paper.classList.add('blank-paper-mode');
            } else {
            paper.classList.add(style);
            }
            paper.classList.add(`paper-${currentPaperColor}`);
            
            // Load appropriate content after style change
            setTimeout(() => {
                if (switchingToBlank) {
                    // Load recording content
                    loadBlankContent();
                    showStatus("🎙️ Switched to recording mode - Use microphone to record", 2000);
                } else if (currentIsBlank && !switchingToBlank) {
                    // Load regular content
                    const saved = localStorage.getItem('digitalNotebook');
                    if (saved) {
                        try {
                            const content = JSON.parse(saved);
                            if (content.note) {
                                const sanitizedContent = content.note.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
                                editor.textContent = sanitizedContent;
                            }
                            applyFontBasedOnContent(editor);
                            showStatus("📝 Regular content restored", 1500);
                        } catch (error) {
                            editor.textContent = '';
                        }
                    } else {
                        editor.textContent = '';
                    }
                }
            }, 100);
            
            // Update active button (desktop dropdown)
            document.querySelectorAll('#formatDropdown .dropdown-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeFormatItem = document.getElementById(`format-${style}`);
            if (activeFormatItem) {
                activeFormatItem.classList.add('active');
            }
            
            // Update mobile dropdown buttons
            const toolsDropdown = document.getElementById('mobileToolsDropdown');
            if (toolsDropdown) {
                const mobileFormatButtons = toolsDropdown.querySelectorAll('[onclick^="changeStyle"]');
                mobileFormatButtons.forEach(btn => {
                    // Reset all buttons to their original gradient colors
                    btn.classList.remove('bg-gradient-to-br', 'from-blue-600', 'to-blue-700');
                    
                    // Set default styling based on button type
                    if (btn.getAttribute('onclick').includes("'lined'")) {
                        btn.className = 'group px-3 py-2 bg-gradient-to-br from-slate-600 to-slate-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105';
                    } else if (btn.getAttribute('onclick').includes("'grid'")) {
                        btn.className = 'group px-3 py-2 bg-gradient-to-br from-slate-600 to-slate-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105';
                    } else if (btn.getAttribute('onclick').includes("'dots'")) {
                        btn.className = 'group px-3 py-2 bg-gradient-to-br from-indigo-600 to-indigo-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105';
                    } else if (btn.getAttribute('onclick').includes("'blank'")) {
                        btn.className = 'group px-3 py-2 bg-gradient-to-br from-purple-600 to-purple-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105';
                    }
                    
                    // Activate the matching button with blue gradient
                    if (btn.getAttribute('onclick').includes(`'${style}'`)) {
                        btn.className = 'group px-3 py-2 bg-gradient-to-br from-blue-600 to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105';
                    }
                });
            }
            
            // Update status
            const styleNames = {
                'lined': 'Classic Ruled Elegance',
                'grid': 'Precision Grid Symphony',
                'dots': 'Sophisticated Dotted Matrix',
                'blank': 'Pure Minimalist Canvas'
            };
            showStatus(`📝 Paper artfully configured to ${styleNames[style] || 'distinctive format'} style`);
        }

        // Change paper color
        function changePaperColor(color) {
            currentPaperColor = color;
            const paper = document.getElementById('notebook-paper');
            const currentStyle = paper.classList.contains('lined') ? 'lined' :
                               paper.classList.contains('grid') ? 'grid' :
                               paper.classList.contains('dots') ? 'dots' : 'blank';
            
            // Reset classes and reapply with new color
            paper.className = 'rounded-lg';
            paper.classList.add(currentStyle);
            paper.classList.add(`paper-${color}`);
            
            // Update status
            const colorNames = {
                'white': 'Pure Snow White Elegance',
                'mint': 'Soft Mint Breeze',
                'gray': 'Light Cloud Gray',
                'cream': 'Gentle Cream Glow',
                'peach': 'Delicate Peach Bloom',
                'rose': 'Soft Rose Petal',
                'beige': 'Warm Ivory Harmony'
            };
            showStatus(`🎨 Paper canvas transformed to ${colorNames[color] || 'exclusive palette'} tone`);
        }

        // Dropdown Management Functions
        let activeDropdown = null;

        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            const trigger = dropdown.previousElementSibling;
            const chevron = trigger.querySelector('i[id$="Chevron"]');
            
            // Close other dropdowns
            document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                if (menu.id !== dropdownId) {
                    menu.classList.remove('show');
                    const otherTrigger = menu.previousElementSibling;
                    const otherChevron = otherTrigger.querySelector('i[id$="Chevron"]');
                    otherTrigger.classList.remove('active');
                    if (otherChevron) {
                        otherChevron.style.transform = 'rotate(0deg)';
                    }
                }
            });
            
            // Toggle current dropdown
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                trigger.classList.remove('active');
                chevron.style.transform = 'rotate(0deg)';
                activeDropdown = null;
            } else {
                dropdown.classList.add('show');
                trigger.classList.add('active');
                chevron.style.transform = 'rotate(180deg)';
                activeDropdown = dropdownId;
            }
        }

        function closeAllDropdowns() {
            document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                menu.classList.remove('show');
                const trigger = menu.previousElementSibling;
                const chevron = trigger.querySelector('i[id$="Chevron"]');
                trigger.classList.remove('active');
                if (chevron) {
                    chevron.style.transform = 'rotate(0deg)';
                }
            });
            activeDropdown = null;
        }

        function selectInkColor(color) {
            // Update active state in dropdown
            document.querySelectorAll('#inkDropdown .dropdown-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.dropdown-item').classList.add('active');
            
            // Close dropdown after selection
            setTimeout(() => {
                closeAllDropdowns();
            }, 300);
        }

        function selectFormat(format) {
            // Update active state in dropdown
            document.querySelectorAll('#formatDropdown .dropdown-item').forEach(item => {
                item.classList.remove('active');
            });
            document.getElementById(`format-${format}`).classList.add('active');
            
            // Close dropdown after selection
            setTimeout(() => {
                closeAllDropdowns();
            }, 300);
        }

        function selectPaperColor(color) {
            // Update active state in dropdown
            document.querySelectorAll('#paperDropdown .dropdown-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.dropdown-item').classList.add('active');
            
            // Close dropdown after selection
            setTimeout(() => {
                closeAllDropdowns();
            }, 300);
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.dropdown-container')) {
                closeAllDropdowns();
            }
        });

        // Close dropdowns on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeAllDropdowns();
                closeMobileDropdown();
            }
        });

        // Mobile tools dropdown management
        function setupMobileToolsDropdown() {
            const mobileToolsBtn = document.getElementById('mobileToolsBtn');
            const mobileToolsDropdown = document.getElementById('mobileToolsDropdown');
            
            if (mobileToolsBtn && mobileToolsDropdown) {
                mobileToolsBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleMobileDropdown();
                });
                
                // Close mobile dropdown when clicking outside
                document.addEventListener('click', function(event) {
                    if (!mobileToolsDropdown.contains(event.target) && !mobileToolsBtn.contains(event.target)) {
                        closeMobileDropdown();
                    }
                });
            }
        }

        function toggleMobileDropdown() {
            const mobileToolsDropdown = document.getElementById('mobileToolsDropdown');
            if (mobileToolsDropdown) {
                if (mobileToolsDropdown.classList.contains('hidden')) {
                    // Close any open regular dropdowns first
                    closeAllDropdowns();
                    mobileToolsDropdown.classList.remove('hidden');
                } else {
                    mobileToolsDropdown.classList.add('hidden');
                }
            }
        }

        function closeMobileDropdown() {
            const mobileToolsDropdown = document.getElementById('mobileToolsDropdown');
            if (mobileToolsDropdown) {
                mobileToolsDropdown.classList.add('hidden');
            }
        }

        // Update dropdown states to reflect current settings
        function updateDropdownStates() {
            // Update ink color dropdown
            document.querySelectorAll('#inkDropdown .dropdown-item').forEach(item => {
                item.classList.remove('active');
                const colorSwatch = item.querySelector('.color-swatch');
                if (colorSwatch) {
                    const bgColor = colorSwatch.style.backgroundColor;
                    if ((bgColor === 'rgb(30, 64, 175)' || bgColor.includes('30, 64, 175')) && currentColor === '#1e40af') {
                        item.classList.add('active');
                    } else if ((bgColor === 'rgb(30, 41, 59)' || bgColor.includes('30, 41, 59')) && currentColor === '#1e293b') {
                        item.classList.add('active');
                    } else if ((bgColor === 'rgb(185, 28, 28)' || bgColor.includes('185, 28, 28')) && currentColor === '#b91c1c') {
                        item.classList.add('active');
                    }
                }
            });

            // Update paper color dropdown
            document.querySelectorAll('#paperDropdown .dropdown-item').forEach(item => {
                item.classList.remove('active');
                const paperSwatch = item.querySelector('.paper-swatch');
                if (paperSwatch) {
                    const itemText = item.querySelector('span').textContent.toLowerCase();
                    if (itemText === currentPaperColor) {
                        item.classList.add('active');
                    }
                }
            });

            // Update format dropdown - ensure lined is active by default
            document.querySelectorAll('#formatDropdown .dropdown-item').forEach(item => {
                item.classList.remove('active');
            });
            const currentFormat = document.getElementById('notebook-paper').classList.contains('lined') ? 'lined' :
                                 document.getElementById('notebook-paper').classList.contains('grid') ? 'grid' :
                                 document.getElementById('notebook-paper').classList.contains('dots') ? 'dots' : 'blank';
            const activeFormatItem = document.getElementById(`format-${currentFormat}`);
            if (activeFormatItem) {
                activeFormatItem.classList.add('active');
            }

            // Set default ink color active state (black)
            if (currentColor === '#1e293b') {
                const blackInkItem = document.querySelector('#inkDropdown .dropdown-item').parentElement.children[1];
                if (blackInkItem) {
                    blackInkItem.classList.add('active');
                }
            }
        }

        // Font Size Control Functions
        function increaseFontSize() {
            if (currentFontSize < 3.0) { // Maximum 3rem
                currentFontSize += 0.1;
                updateFontSize();
                showStatus(`📈 Font size increased to ${currentFontSize.toFixed(1)}rem`);
            } else {
                showStatus(`⚠️ Maximum font size reached (3.0rem)`);
            }
        }

        function decreaseFontSize() {
            if (currentFontSize > 0.8) { // Minimum 0.8rem
                currentFontSize -= 0.1;
                updateFontSize();
                showStatus(`📉 Font size decreased to ${currentFontSize.toFixed(1)}rem`);
            } else {
                showStatus(`⚠️ Minimum font size reached (0.8rem)`);
            }
        }

        function resetFontSize() {
            currentFontSize = 1.4; // Default size
            updateFontSize();
            showStatus(`🔄 Font size reset to default (1.4rem)`);
        }

        function updateFontSize() {
            // Set CSS custom property for dynamic sizing
            document.documentElement.style.setProperty('--current-font-size', `${currentFontSize}rem`);
            
            // Update editor font size
            editor.style.fontSize = `${currentFontSize}rem`;
            
            // Update Arabic text if present (handled by CSS now)
            if (editor.classList.contains('arabic-content')) {
                editor.style.fontSize = `${currentFontSize + 0.2}rem`; // Arabic text is slightly larger
            }
            
            // Update display indicators
            const fontSizeText = `${currentFontSize.toFixed(1)}rem`;
            const fontSizeDisplayMobile = document.getElementById('fontSizeDisplayMobile');
            const fontSizeDisplayDropdown = document.getElementById('fontSizeDisplayDropdown');
            
            if (fontSizeDisplayMobile) {
                fontSizeDisplayMobile.textContent = fontSizeText;
            }
            if (fontSizeDisplayDropdown) {
                fontSizeDisplayDropdown.textContent = fontSizeText;
            }
            
            // Save font size to localStorage
            try {
                const saved = localStorage.getItem('digitalNotebook');
                const content = saved ? JSON.parse(saved) : {};
                content.fontSize = currentFontSize;
                localStorage.setItem('digitalNotebook', JSON.stringify(content));
            } catch (error) {
                console.error("Error saving font size:", error);
            }
        }

        // Detect the language of the current content to set appropriate voice recognition
        function detectLanguageFromContent() {
            const editorText = editor.textContent || editor.innerText || '';
            if (isArabicText(editorText)) {
                return 'ar-SA';
            } else {
                return 'en-US';
            }
        }
        
        // ==================== المصحح اللغوي الذكي (تلقائي مع التحويل الصوتي) ====================
        
        // قاموس التصحيحات الشامل للغة الإنجليزية - محدث 2025
        const englishCorrections = {
            // الأخطاء الإملائية الشائعة
            'teh': 'the', 'hte': 'the', 'tehm': 'them', 'taht': 'that', 'waht': 'what',
            'adn': 'and', 'nad': 'and', 'anbd': 'and', 'wih': 'with', 'wiht': 'with',
            'thier': 'their', 'there': 'their', 'theyre': "they're", 'theres': "there's",
            'youre': "you're", 'your': "you're", 'yoour': "your", 'yuor': "your",
            'its': "it's", 'recieve': 'receive', 'seperate': 'separate', 'lose': 'loose',
            'definately': 'definitely', 'defiantly': 'definitely', 'definetly': 'definitely',
            'occured': 'occurred', 'ocurred': 'occurred', 'occurence': 'occurrence',
            'begining': 'beginning', 'beggining': 'beginning', 'beginng': 'beginning',
            'sucess': 'success', 'sucessful': 'successful', 'succesful': 'successful',
            'necesary': 'necessary', 'neccessary': 'necessary', 'necessery': 'necessary',
            'accomodate': 'accommodate', 'acommodate': 'accommodate', 'acomodate': 'accommodate',
            'existance': 'existence', 'existense': 'existence', 'exsistence': 'existence',
            'independant': 'independent', 'independet': 'independent', 'independant': 'independent',
            'proffesional': 'professional', 'profesional': 'professional', 'proffessional': 'professional',
            'beleive': 'believe', 'belive': 'believe', 'beleave': 'believe',
            'wierd': 'weird', 'weired': 'weird', 'wired': 'weird',
            'freind': 'friend', 'frend': 'friend', 'freind': 'friend',
            'buisness': 'business', 'bussiness': 'business', 'busines': 'business',
            'tommorrow': 'tomorrow', 'tommorow': 'tomorrow', 'tomarow': 'tomorrow',
            'untill': 'until', 'truely': 'truly', 'truley': 'truly', 'realy': 'really',
            'fourty': 'forty', 'nineth': 'ninth', 'twelth': 'twelfth',
            
            // التقنية والبرمجة
            'programing': 'programming', 'programer': 'programmer', 'progamming': 'programming',
            'developement': 'development', 'devlopment': 'development', 'developmet': 'development',
            'enviroment': 'environment', 'enviornment': 'environment', 'envrionment': 'environment',
            'managment': 'management', 'managament': 'management', 'mangement': 'management',
            'arguement': 'argument', 'arguemnt': 'argument', 'argement': 'argument',
            'maintainance': 'maintenance', 'maintanance': 'maintenance', 'maintainence': 'maintenance',
            'algorithm': 'algorithm', 'algoritm': 'algorithm', 'algorythm': 'algorithm',
            'database': 'database', 'databse': 'database', 'databas': 'database',
            'javascript': 'JavaScript', 'Java script': 'JavaScript', 'java script': 'JavaScript',
            'artifical': 'artificial', 'artficial': 'artificial', 'artificail': 'artificial',
            
            // مصطلحات حديثة (AI & Tech)
            'machinelearning': 'machine learning', 'deeplearning': 'deep learning',
            'artificialintelligence': 'artificial intelligence', 'chatgpt': 'ChatGPT',
            'openai': 'OpenAI', 'claude': 'Claude', 'blockchain': 'blockchain',
            'cryptocurrency': 'cryptocurrency', 'bitcoin': 'Bitcoin', 'ethereum': 'Ethereum',
            'smartphone': 'smartphone', 'iphone': 'iPhone', 'android': 'Android',
            'facebook': 'Facebook', 'instagram': 'Instagram', 'twitter': 'Twitter',
            'youtube': 'YouTube', 'linkedin': 'LinkedIn', 'tiktok': 'TikTok',
            'netflix': 'Netflix', 'amazon': 'Amazon', 'google': 'Google',
            'microsoft': 'Microsoft', 'apple': 'Apple', 'tesla': 'Tesla',
            
            // اختصارات شائعة
            'dont': "don't", 'cant': "can't", 'wont': "won't", 'isnt': "isn't",
            'shouldnt': "shouldn't", 'wouldnt': "wouldn't", 'couldnt': "couldn't",
            'havent': "haven't", 'hasnt': "hasn't", 'hadnt': "hadn't",
            'arent': "aren't", 'wasnt': "wasn't", 'werent': "weren't",
            'doesnt': "doesn't", 'didnt': "didn't", 'mustnt': "mustn't",
            
            // أخطاء شائعة أخرى
            'alot': 'a lot', 'allot': 'a lot', 'everytime': 'every time',
            'sometime': 'sometimes', 'alright': 'all right', 'altogether': 'all together',
            'alway': 'always', 'befor': 'before', 'wich': 'which', 'witch': 'which',
            'becuase': 'because', 'basicly': 'basically', 'finaly': 'finally',
            'probaly': 'probably', 'diferent': 'different', 'diference': 'difference',
            'similiar': 'similar', 'completly': 'completely', 'absolutly': 'absolutely',
            'imediately': 'immediately', 'convinient': 'convenient', 'embarasing': 'embarrassing',
            'disapointed': 'disappointed', 'recomend': 'recommend', 'responsable': 'responsible',
            'goverment': 'government', 'explaination': 'explanation', 'grammer': 'grammar',
            
            // كلمات إضافية متقدمة
            'مكاتبه': 'مكاتبة', 'مراسله': 'مراسلة', 'محادثه': 'محادثة', 'مناقشه': 'مناقشة',
            'مشاهده': 'مشاهدة', 'متابعه': 'متابعة', 'مراجعه': 'مراجعة', 'مطالعه': 'مطالعة',
            'قراءه': 'قراءة', 'كتابه': 'كتابة', 'طباعه': 'طباعة', 'مشاركه': 'مشاركة',
            
            // أسماء الدول والمدن
            'امريكا': 'أمريكا', 'اوروبا': 'أوروبا', 'افريقيا': 'أفريقيا', 'اسيا': 'آسيا',
            'استراليا': 'أستراليا', 'انجلترا': 'إنجلترا', 'ايطاليا': 'إيطاليا', 'اسبانيا': 'إسبانيا',
            'المانيا': 'ألمانيا', 'فرنسا': 'فرنسا', 'اليابان': 'اليابان', 'الصين': 'الصين',
            'روسيا': 'روسيا', 'البرازيل': 'البرازيل', 'كندا': 'كندا', 'المكسيك': 'المكسيك',
            
            // مصطلحات طبية حديثة
            'كورونا': 'كورونا', 'كوفيد': 'كوفيد', 'لقاح': 'لقاح', 'تطعيم': 'تطعيم',
            'فيروس': 'فيروس', 'بكتيريا': 'بكتيريا', 'مضاد حيوي': 'مضاد حيوي',
            'صحه': 'صحة', 'مريض': 'مريض', 'مرضى': 'مرضى', 'دواء': 'دواء',
            'ادويه': 'أدوية', 'علاج': 'علاج', 'دكتور': 'دكتور', 'طبيب': 'طبيب',
            
            // مصطلحات اقتصادية ومالية
            'اقتصاد': 'اقتصاد', 'اسهم': 'أسهم', 'اسواق': 'أسواق', 'استثمار': 'استثمار',
            'عمله': 'عملة', 'عملات': 'عملات', 'دولار': 'دولار', 'يورو': 'يورو',
            'جنيه': 'جنيه', 'ريال': 'ريال', 'درهم': 'درهم', 'دينار': 'دينار',
            'تداول': 'تداول', 'بورصه': 'بورصة', 'بنك': 'بنك', 'بنوك': 'بنوك',
            
            // مصطلحات رياضية
            'كوره': 'كرة', 'رياضه': 'رياضة', 'فريق': 'فريق', 'مباراه': 'مباراة',
            'مباريات': 'مباريات', 'لاعب': 'لاعب', 'لاعبين': 'لاعبين', 'هدف': 'هدف',
            'اهداف': 'أهداف', 'نتيجه': 'نتيجة', 'بطوله': 'بطولة', 'كاس': 'كأس',
            'ميداليه': 'ميدالية', 'ذهبيه': 'ذهبية', 'فضيه': 'فضية', 'برونزيه': 'برونزية',
            
            // كلمات الطعام والشراب
            'اكل': 'أكل', 'طعام': 'طعام', 'شراب': 'شراب', 'مشروب': 'مشروب',
            'مشروبات': 'مشروبات', 'قهوه': 'قهوة', 'شاي': 'شاي', 'عصير': 'عصير',
            'فطار': 'فطار', 'غداء': 'غداء', 'عشاء': 'عشاء', 'وجبه': 'وجبة',
            'وجبات': 'وجبات', 'مطعم': 'مطعم', 'مطاعم': 'مطاعم', 'كافيه': 'كافيه',
            
            // كلمات متعلقة بالعمل والوظائف
            'وظيفه': 'وظيفة', 'وظائف': 'وظائف', 'شغل': 'شغل', 'عمل': 'عمل',
            'موظف': 'موظف', 'موظفين': 'موظفين', 'شركه': 'شركة', 'شركات': 'شركات',
            'مؤسسه': 'مؤسسة', 'مؤسسات': 'مؤسسات', 'مكتب': 'مكتب', 'مكاتب': 'مكاتب',
            'رئيس': 'رئيس', 'مدير': 'مدير', 'مديرين': 'مديرين', 'مهندس': 'مهندس',
            
            // كلمات السفر والسياحة
            'سفر': 'سفر', 'سياحه': 'سياحة', 'رحله': 'رحلة', 'رحلات': 'رحلات',
            'سائح': 'سائح', 'سياح': 'سياح', 'فندق': 'فندق', 'فنادق': 'فنادق',
            'طياره': 'طيارة', 'طيران': 'طيران', 'مطار': 'مطار', 'مطارات': 'مطارات',
            'تذكره': 'تذكرة', 'تذاكر': 'تذاكر', 'حجز': 'حجز', 'حجوزات': 'حجوزات'
        };

        // قاموس التصحيحات الشامل للغة العربية - محدث 2025
        const arabicCorrections = {
            // الأخطاء الإملائية الأساسية
            'هذة': 'هذه', 'هاذه': 'هذه', 'هاذا': 'هذا', 'هاؤلاء': 'هؤلاء',
            'ذالك': 'ذلك', 'اولئك': 'أولئك', 'التى': 'التي', 'اللذي': 'الذي',
            'اللتي': 'التي', 'اللواتي': 'اللاتي', 'اللائي': 'اللائي',
            
            // التحيات والعبارات الإسلامية
            'ان شاء الله': 'إن شاء الله', 'انشاء الله': 'إن شاء الله', 'ان شالله': 'إن شاء الله',
            'الحمدلله': 'الحمد لله', 'لا اله الا الله': 'لا إله إلا الله',
            'استغفر الله': 'أستغفر الله', 'السلام عليكم': 'السلام عليكم',
            'مع السلامه': 'مع السلامة', 'السلام عليكم ورحمه الله': 'السلام عليكم ورحمة الله',
            'بارك الله فيك': 'بارك الله فيك', 'جزاك الله خيرا': 'جزاك الله خيراً',
            
            // التحيات العامة وكلمات الأدب
            'اهلا وسهلا': 'أهلاً وسهلاً', 'اهلا': 'أهلاً', 'مرحبا': 'مرحباً',
            'شكرا': 'شكراً', 'عفوا': 'عفواً', 'اسف': 'آسف', 'متاسف': 'متأسف',
            'من فضلك': 'من فضلك', 'لو سمحت': 'لو سمحت', 'بعد اذنك': 'بعد إذنك',
            'اذن': 'إذن', 'اذا': 'إذا', 'الا': 'إلا', 'امام': 'أمام',
            
            // أدوات الاستفهام والظروف
            'ايضا': 'أيضاً', 'ايش': 'أيش', 'ايه': 'أيه', 'اين': 'أين',
            'ايمتى': 'أيمتى', 'امتى': 'متى', 'ليه': 'ليه', 'ازاي': 'إزاي',
            'كده': 'كده', 'علشان': 'علشان', 'عشان': 'عشان', 'ايه': 'إيه',
            
            // أرقام وكلمات الزمن
            'احد': 'أحد', 'اول': 'أول', 'اخر': 'آخر', 'اخير': 'أخير',
            'امس': 'أمس', 'غدا': 'غداً', 'بكرا': 'بكرة', 'دلوقتي': 'دلوقتي',
            'دلوقت': 'دلوقتي', 'حاليا': 'حالياً', 'فورا': 'فوراً',
            
            // الصفات والمقارنات
            'افضل': 'أفضل', 'اكثر': 'أكثر', 'اقل': 'أقل', 'اكبر': 'أكبر',
            'اصغر': 'أصغر', 'اجمل': 'أجمل', 'احسن': 'أحسن', 'اعلى': 'أعلى',
            'ادنى': 'أدنى', 'اهم': 'أهم', 'اسهل': 'أسهل', 'اصعب': 'أصعب',
            'اوسع': 'أوسع', 'اضيق': 'أضيق', 'اطول': 'أطول', 'اقصر': 'أقصر',
            
            // التقنية والتكنولوجيا
            'برمجه': 'برمجة', 'تطوير': 'تطوير', 'تصميم': 'تصميم', 'صفحه': 'صفحة',
            'موقع': 'موقع', 'تطبيق': 'تطبيق', 'برنامج': 'برنامج', 'انترنت': 'إنترنت',
            'الانترنت': 'الإنترنت', 'ايميل': 'إيميل', 'البريد الالكتروني': 'البريد الإلكتروني',
            'كمبيوتر': 'كمبيوتر', 'لابتوب': 'لابتوب', 'موبايل': 'موبايل', 'هاتف': 'هاتف',
            
            // مصطلحات حديثة وذكاء اصطناعي
            'ذكاء اصطناعي': 'ذكاء اصطناعي', 'ذكاء صناعي': 'ذكاء اصطناعي',
            'تعلم الالة': 'تعلم الآلة', 'تعلم عميق': 'تعلم عميق', 'بيانات ضخمة': 'بيانات ضخمة',
            'التعلم الالي': 'التعلم الآلي', 'خوارزمية': 'خوارزمية', 'خوارزميات': 'خوارزميات',
            'روبوت': 'روبوت', 'اتمتة': 'أتمتة', 'منصة': 'منصة', 'رقمي': 'رقمي',
            'رقمنة': 'رقمنة', 'تقني': 'تقني', 'تكنولوجيا': 'تكنولوجيا', 'تكنولوجيه': 'تكنولوجيا',
            
            // اللغات والجنسيات
            'انجليزي': 'إنجليزي', 'الانجليزية': 'الإنجليزية', 'عربي': 'عربي',
            'اسلامي': 'إسلامي', 'مسيحي': 'مسيحي', 'امريكي': 'أمريكي',
            'اوروبي': 'أوروبي', 'افريقي': 'أفريقي', 'اسيوي': 'آسيوي',
            
            // كلمات عامة وشائعة
            'انسان': 'إنسان', 'انسانة': 'إنسانة', 'اطفال': 'أطفال',
            'استاذ': 'أستاذ', 'استاذة': 'أستاذة', 'مدرس': 'مدرس',
            'طالب': 'طالب', 'طالبة': 'طالبة', 'جامعة': 'جامعة',
            'مدرسة': 'مدرسة', 'اسئلة': 'أسئلة', 'سؤال': 'سؤال',
            'اجابة': 'إجابة', 'اجابات': 'إجابات', 'معلومات': 'معلومات',
            'اخبار': 'أخبار', 'جديد': 'جديد', 'قديم': 'قديم', 'حديث': 'حديث',
            
            // أسماء المواقع والشركات التقنية
            'فيسبوك': 'فيسبوك', 'انستغرام': 'إنستغرام', 'واتساب': 'واتساب',
            'تويتر': 'تويتر', 'يوتيوب': 'يوتيوب', 'تيك توك': 'تيك توك',
            'جوجل': 'جوجل', 'مايكروسوفت': 'مايكروسوفت', 'ابل': 'آبل',
            'سامسونغ': 'سامسونغ', 'هواوي': 'هواوي', 'نوكيا': 'نوكيا',
            
            // مجالات متخصصة
            'الكترونية': 'إلكترونية', 'الكتروني': 'إلكتروني', 'اقتصاد': 'اقتصاد',
            'اقتصادي': 'اقتصادي', 'سياسة': 'سياسة', 'سياسي': 'سياسي',
            'اجتماعي': 'اجتماعي', 'ثقافي': 'ثقافي', 'ثقافة': 'ثقافة',
            'تعليم': 'تعليم', 'تعليمي': 'تعليمي', 'طبي': 'طبي',
            'طبية': 'طبية', 'صحي': 'صحي', 'صحة': 'صحة', 'علمي': 'علمي',
            
            // كلمات حديثة من السوشيال ميديا
            'لايك': 'لايك', 'شير': 'شير', 'فولو': 'فولو', 'كومنت': 'كومنت',
            'ريتويت': 'ريتويت', 'هاشتاغ': 'هاشتاغ', 'تاغ': 'تاغ',
            'ستوري': 'ستوري', 'بوست': 'بوست', 'لايف': 'لايف',
            'سترتش': 'ستريتش', 'تريند': 'تريند', 'ترندنغ': 'ترندنغ',
            
            // كلمات إضافية متقدمة
            'مكاتبه': 'مكاتبة', 'مراسله': 'مراسلة', 'محادثه': 'محادثة', 'مناقشه': 'مناقشة',
            'مشاهده': 'مشاهدة', 'متابعه': 'متابعة', 'مراجعه': 'مراجعة', 'مطالعه': 'مطالعة',
            'قراءه': 'قراءة', 'كتابه': 'كتابة', 'طباعه': 'طباعة', 'مشاركه': 'مشاركة',
            
            // أسماء الدول والمدن
            'امريكا': 'أمريكا', 'اوروبا': 'أوروبا', 'افريقيا': 'أفريقيا', 'اسيا': 'آسيا',
            'استراليا': 'أستراليا', 'انجلترا': 'إنجلترا', 'ايطاليا': 'إيطاليا', 'اسبانيا': 'إسبانيا',
            'المانيا': 'ألمانيا', 'فرنسا': 'فرنسا', 'اليابان': 'اليابان', 'الصين': 'الصين',
            'روسيا': 'روسيا', 'البرازيل': 'البرازيل', 'كندا': 'كندا', 'المكسيك': 'المكسيك',
            
            // مصطلحات طبية حديثة
            'كورونا': 'كورونا', 'كوفيد': 'كوفيد', 'لقاح': 'لقاح', 'تطعيم': 'تطعيم',
            'فيروس': 'فيروس', 'بكتيريا': 'بكتيريا', 'مضاد حيوي': 'مضاد حيوي',
            'صحه': 'صحة', 'مريض': 'مريض', 'مرضى': 'مرضى', 'دواء': 'دواء',
            'ادويه': 'أدوية', 'علاج': 'علاج', 'دكتور': 'دكتور', 'طبيب': 'طبيب',
            
            // مصطلحات اقتصادية ومالية
            'اقتصاد': 'اقتصاد', 'اسهم': 'أسهم', 'اسواق': 'أسواق', 'استثمار': 'استثمار',
            'عمله': 'عملة', 'عملات': 'عملات', 'دولار': 'دولار', 'يورو': 'يورو',
            'جنيه': 'جنيه', 'ريال': 'ريال', 'درهم': 'درهم', 'دينار': 'دينار',
            'تداول': 'تداول', 'بورصه': 'بورصة', 'بنك': 'بنك', 'بنوك': 'بنوك',
            
            // مصطلحات رياضية
            'كوره': 'كرة', 'رياضه': 'رياضة', 'فريق': 'فريق', 'مباراه': 'مباراة',
            'مباريات': 'مباريات', 'لاعب': 'لاعب', 'لاعبين': 'لاعبين', 'هدف': 'هدف',
            'اهداف': 'أهداف', 'نتيجه': 'نتيجة', 'بطوله': 'بطولة', 'كاس': 'كأس',
            'ميداليه': 'ميدالية', 'ذهبيه': 'ذهبية', 'فضيه': 'فضية', 'برونزيه': 'برونزية',
            
            // كلمات الطعام والشراب
            'اكل': 'أكل', 'طعام': 'طعام', 'شراب': 'شراب', 'مشروب': 'مشروب',
            'مشروبات': 'مشروبات', 'قهوه': 'قهوة', 'شاي': 'شاي', 'عصير': 'عصير',
            'فطار': 'فطار', 'غداء': 'غداء', 'عشاء': 'عشاء', 'وجبه': 'وجبة',
            'وجبات': 'وجبات', 'مطعم': 'مطعم', 'مطاعم': 'مطاعم', 'كافيه': 'كافيه',
            
            // كلمات متعلقة بالعمل والوظائف
            'وظيفه': 'وظيفة', 'وظائف': 'وظائف', 'شغل': 'شغل', 'عمل': 'عمل',
            'موظف': 'موظف', 'موظفين': 'موظفين', 'شركه': 'شركة', 'شركات': 'شركات',
            'مؤسسه': 'مؤسسة', 'مؤسسات': 'مؤسسات', 'مكتب': 'مكتب', 'مكاتب': 'مكاتب',
            'رئيس': 'رئيس', 'مدير': 'مدير', 'مديرين': 'مديرين', 'مهندس': 'مهندس',
            
            // كلمات السفر والسياحة
            'سفر': 'سفر', 'سياحه': 'سياحة', 'رحله': 'رحلة', 'رحلات': 'رحلات',
            'سائح': 'سائح', 'سياح': 'سياح', 'فندق': 'فندق', 'فنادق': 'فنادق',
            'طياره': 'طيارة', 'طيران': 'طيران', 'مطار': 'مطار', 'مطارات': 'مطارات',
            'تذكره': 'تذكرة', 'تذاكر': 'تذاكر', 'حجز': 'حجز', 'حجوزات': 'حجوزات'
        };

        // دالة المصحح اللغوي المحسنة (تعمل تلقائياً مع التحويل الصوتي) - Enhanced performance
        function applySpellCorrection(text, language) {
            if (!text || text.trim() === '') return text;
            
            let correctedText = text;
            let correctionsApplied = 0;
            
            // اختيار القاموس المناسب حسب اللغة
            const dictionary = language === 'ar-SA' ? arabicCorrections : englishCorrections;
            
            // تحسين الأداء: استخدام كامل القاموس مع تحسين الأداء
            for (const [wrong, correct] of Object.entries(dictionary)) {
                try {
                    // استخدام indexOf للتحقق الأولي الأسرع
                    if (correctedText.indexOf(wrong) !== -1) {
                        const wrongPattern = new RegExp(`\\b${wrong}\\b`, 'gi');
                        if (wrongPattern.test(correctedText)) {
                            correctedText = correctedText.replace(wrongPattern, correct);
                            correctionsApplied++;
                        }
                    }
                } catch (error) {
                    console.warn(`Regex error for correction "${wrong}":`, error);
                    continue; // تخطي هذا التصحيح إذا كان هناك خطأ في التعبير النمطي
                }
            }
            
            // تصحيحات إضافية خاصة بالعربية
            if (language === 'ar-SA') {
                // تصحيح الهمزات في بداية الكلمات
                const beforeHamza = correctedText;
                correctedText = correctedText.replace(/\bا([لبتثجحخدذرزسشصضطظعغفقكلمنهوي])/g, 'أ$1');
                if (correctedText !== beforeHamza) correctionsApplied++;
                
                // تصحيح الألف المقصورة
                const beforeAlif = correctedText;
                correctedText = correctedText.replace(/ي\s/g, 'ى ');
                correctedText = correctedText.replace(/ي\./g, 'ى.');
                correctedText = correctedText.replace(/ي\,/g, 'ى,');
                if (correctedText !== beforeAlif) correctionsApplied++;
            }
            
            // تصحيحات إضافية خاصة بالإنجليزية
            if (language === 'en-US') {
                // تصحيح الأحرف الكبيرة في بداية الجمل
                const beforeCapital = correctedText;
                correctedText = correctedText.replace(/(^|\.\s+)([a-z])/g, (match, p1, p2) => {
                    return p1 + p2.toUpperCase();
                });
                
                // تصحيح I إلى I دائماً
                correctedText = correctedText.replace(/\bi\s/g, 'I ');
                correctedText = correctedText.replace(/\bi\./g, 'I.');
                correctedText = correctedText.replace(/\bi\,/g, 'I,');
                if (correctedText !== beforeCapital) correctionsApplied++;
            }
            
            // إضافة مؤشر بصري للتصحيحات
            if (correctionsApplied > 0) {
                console.log(`🔧 Applied ${correctionsApplied} linguistic corrections`);
            }
            
            return correctedText;
        }


        
                    // Removed isSecureContext check - GitHub Pages provides HTTPS by default



            function setupRecognition() {
                // Improved browser support detection
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    showStatus("🚫 Voice recognition not supported in this browser");
                    return null;
                }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognitionInstance = new SpeechRecognition();
            
            recognitionInstance.continuous = true;
            recognitionInstance.interimResults = true;
            recognitionInstance.lang = currentLanguage;
            
            recognitionInstance.onstart = () => {
                isRecording = true;
                if (!isWhatsAppRecording) {
                    const langMessage = currentLanguage === 'ar-SA' ?
                        '🎙️ Attentively listening to your Arabic expressions...' :
                        '🎙️ Capturing your English speech elegantly...';
                    showStatus(langMessage);
                }
            };
            
            recognitionInstance.onresult = (event) => {
                let finalTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript + ' ';
                    }
                }
                
                if (finalTranscript) {
                    // Detect language and switch if needed
                    const detectedLanguage = detectLanguageFromVoice(finalTranscript);
                    if (detectedLanguage !== currentLanguage) {
                        currentLanguage = detectedLanguage;
                        recognitionInstance.lang = currentLanguage;
                        const langName = currentLanguage === 'ar-SA' ? 'Arabic' : 'English';
                        showStatus(`🌐 Automatically switched to ${langName} recognition`);
                        // Update language indicator in recording status
                        updateLanguageIndicator(currentLanguage);
                    }
                    
                    // Apply spell correction
                    const correctedText = applySpellCorrection(finalTranscript, currentLanguage);
                    
                    // Insert organized transcription with timestamp and alignment
                    insertTranscriptionWithTimestamp(correctedText, detectedLanguage);
                    
                    // Apply font styling based on content
                    applyFontBasedOnContent(editor);
                    
                    // Trigger input event for auto-save
                    const inputEvent = new Event('input', { bubbles: true });
                    editor.dispatchEvent(inputEvent);
                    
                    // Show success message with language indicator
                    const langIndicator = currentLanguage === 'ar-SA' ? 
                        '<span class="language-indicator language-arabic">AR</span>' : 
                        '<span class="language-indicator language-english">EN</span>';
                    
                    if (correctedText !== finalTranscript) {
                        showStatus(`✨ Auto-corrected and transcribed ${langIndicator}: "${correctedText.trim()}" 📝`);
                    } else {
                        showStatus(`✨ Successfully transcribed ${langIndicator}: "${finalTranscript.trim()}" ✅`);
                    }
                }
            };

        // Insert Transcription with Professional Formatting
        function insertTranscriptionWithTimestamp(text, language) {
            const timestamp = new Date();
            const isArabic = language === 'ar-SA';
            
            // Create transcription block
            const transcriptionBlock = createTranscriptionBlock(text, timestamp, isArabic);
            
            // Find the transcription container (for recording sessions)
            let transcriptionContainer = document.getElementById('transcriptionContainer');
            
            if (transcriptionContainer) {
                // We're in a recording session, add to the container
                transcriptionContainer.appendChild(transcriptionBlock);
            } else {
                // Fallback: insert at current cursor position or at the end
                const selection = window.getSelection();
                let insertionPoint;
                
                if (selection.rangeCount > 0) {
                    const range = selection.getRangeAt(0);
                    insertionPoint = range.startContainer;
                    
                    // If we're in a text node, get the parent element
                    if (insertionPoint.nodeType === Node.TEXT_NODE) {
                        insertionPoint = insertionPoint.parentElement;
                    }
                }
                
                // Insert the transcription block
                if (insertionPoint && editor.contains(insertionPoint)) {
                    insertionPoint.after(transcriptionBlock);
                } else {
                    editor.appendChild(transcriptionBlock);
                }
            }
            
            // Set cursor position after the inserted block
            const range = document.createRange();
            const newSelection = window.getSelection();
            range.setStartAfter(transcriptionBlock);
            range.collapse(true);
            newSelection.removeAllRanges();
            newSelection.addRange(range);
            
            // Scroll to show the new content smoothly
            transcriptionBlock.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Create Professional Transcription Block with Merge Controls
        function createTranscriptionBlock(text, timestamp, isArabic) {
            const block = document.createElement('div');
            block.className = `transcription-block ${isArabic ? 'arabic-transcription' : 'english-transcription'}`;
            block.setAttribute('data-block-id', `block-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`);
            block.setAttribute('data-language', isArabic ? 'ar' : 'en');
            block.setAttribute('data-timestamp', timestamp.toISOString());
            
            const timeStr = timestamp.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            });
            
            const dateStr = timestamp.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric'
            });
            
            block.innerHTML = `
                <div class="transcription-header">
                    <div class="transcription-meta">
                        <span class="transcription-time">
                            <i class="fas fa-clock"></i>
                            ${timeStr}
                        </span>
                        <span class="transcription-date">
                            <i class="fas fa-calendar"></i>
                            ${dateStr}
                        </span>
                        <span class="transcription-language">
                            <i class="fas fa-language"></i>
                            ${isArabic ? 'العربية' : 'English'}
                        </span>
                    </div>
                    <div class="transcription-actions">
                        <button class="merge-btn" onclick="toggleBlockSelection(this)" title="Select for merging">
                            <i class="fas fa-plus-circle"></i>
                            <span>Select</span>
                        </button>
                        <button class="copy-btn" onclick="copyBlockText(this)" title="Copy text">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="edit-btn" onclick="editBlockText(this)" title="Edit text">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </div>
                <div class="transcription-content ${isArabic ? 'rtl-content' : 'ltr-content'}" contenteditable="false">
                    ${text.trim()}
                </div>
                <div class="transcription-divider"></div>
            `;
            
            return block;
        }
            
            recognitionInstance.onerror = (event) => {
                let errorMessage = "🚨 Voice Recognition Error: ";
                switch (event.error) {
                    case 'no-speech':
                        errorMessage += 'No clear speech detected';
                        break;
                    case 'audio-capture':
                        errorMessage += 'Cannot access microphone';
                        break;
                    case 'not-allowed':
                        errorMessage += 'Microphone access permission denied';
                        setTimeout(showPermissionHelp, 2000);
                        break;
                    case 'network':
                        errorMessage += 'Network connection issue';
                        break;
                    default:
                        errorMessage += `Unexpected error: ${event.error}`;
                }
                showStatus(errorMessage);
                
                if (isWhatsAppRecording) {
                    stopWhatsAppRecording();
                }
            };
            
            recognitionInstance.onend = () => {
                if (isRecording && !isWhatsAppRecording) {
                    // Restart recognition if still in recording state
                    setTimeout(() => {
                        if (isRecording && recognitionInstance && !isWhatsAppRecording) {
                            try {
                                recognitionInstance.start();
                            } catch (e) {
                                console.error("Failed to restart recognition:", e);
                            }
                        }
                    }, 1000);
                } else if (!isWhatsAppRecording) {
                    showStatus("🔇 Voice recognition stopped");
                }
            };
            
            return recognitionInstance;
        }
        
        // Save note - Enhanced security and performance with separate storage for recordings
        function saveNote() {
            // Determine if we're in blank mode (recording mode)
            const paper = document.getElementById('notebook-paper');
            const isBlankMode = paper.className.includes('blank-paper-mode');
            
            if (isBlankMode) {
                // Save to blank mode storage (recordings only)
                saveBlankContent();
                showStatus("🎙️ Recording session saved securely", 2000);
            } else {
                // Save to regular storage (normal notes only)
            const content = {
                note: editor.textContent || editor.innerText || '', // Use textContent for security
                color: currentColor,
                paperColor: currentPaperColor,
                style: document.getElementById('notebook-paper').className.replace('rounded-lg', '').trim(),
                    language: currentLanguage,
                    fontSize: currentFontSize
            };
            
            try {
                localStorage.setItem('digitalNotebook', JSON.stringify(content));
                showStatus("💾 Your distinguished configuration saved securely", 2000);
            } catch (error) {
                console.error("Error saving content:", error);
                showStatus("⚠️ Error saving content. Please try again.", 3000);
                }
            }
        }

        // Save to regular storage (non-blank content)
        function saveNoteToRegularStorage() {
            try {
                const paper = document.getElementById('notebook-paper');
                const isBlankMode = paper.className.includes('blank-paper-mode');
                
                // Only save if we have non-blank content
                if (!isBlankMode && editor.textContent.trim()) {
                    const content = {
                        note: editor.textContent || editor.innerText || '',
                        color: currentColor,
                        paperColor: currentPaperColor,
                        style: document.getElementById('notebook-paper').className.replace('rounded-lg', '').trim(),
                        language: currentLanguage,
                        fontSize: currentFontSize
                    };
                    localStorage.setItem('digitalNotebook', JSON.stringify(content));
                }
            } catch (error) {
                console.error('Regular save error:', error);
            }
        }

        // Save blank content (recordings only)
        function saveBlankContent() {
            try {
                const blankData = {
                    content: editor.innerHTML, // Keep innerHTML for transcription blocks
                    timestamp: new Date().toISOString(),
                    fontSize: currentFontSize,
                    inkColor: currentColor
                };
                localStorage.setItem('blankRecordings', JSON.stringify(blankData));
            } catch (error) {
                console.error('Blank save error:', error);
            }
        }

        // Load blank content (recordings)
        function loadBlankContent() {
            try {
                const blankData = localStorage.getItem('blankRecordings');
                if (blankData) {
                    const data = JSON.parse(blankData);
                    editor.innerHTML = data.content || '';
                    
                    // Restore blank-specific settings
                    if (data.fontSize) {
                        currentFontSize = data.fontSize;
                        updateFontSize();
                    }
                    if (data.inkColor) {
                        currentColor = data.inkColor;
                        editor.style.color = currentColor;
                    }
                } else {
                    // No previous recordings, start fresh
                    editor.innerHTML = '';
                }
            } catch (error) {
                console.error('Blank load error:', error);
                editor.innerHTML = '';
            }
        }
        
        // Load saved content - Enhanced security and performance with separate storage handling
        function loadSavedContent() {
            // Check current paper mode to determine which content to load
            const paper = document.getElementById('notebook-paper');
            const isBlankMode = paper.className.includes('blank-paper-mode');
            
            if (isBlankMode) {
                // Load blank content (recordings)
                loadBlankContent();
                showStatus("🎙️ Recording session restored");
            } else {
                // Load regular content (normal notes)
            const saved = localStorage.getItem('digitalNotebook');
            if (saved) {
                try {
                    const content = JSON.parse(saved);
                        
                        // Load font size
                        if (content.fontSize && typeof content.fontSize === 'number') {
                            currentFontSize = Math.max(0.8, Math.min(3.0, content.fontSize)); // Ensure within bounds
                            updateFontSize();
                        }
                    
                    // Secure content loading - use textContent instead of innerHTML for security
                    if (content.note && typeof content.note === 'string') {
                        // Sanitize content before loading
                        const sanitizedContent = content.note.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
                        editor.textContent = sanitizedContent;
                    }
                    
                    currentColor = content.color || '#1e293b';
                    currentPaperColor = content.paperColor || 'white';
                    // Load language or default to Arabic
                    currentLanguage = content.language || 'ar-SA';
                    
                    // Set color
                    editor.style.color = currentColor;
                    
                    // Apply appropriate fonts based on content
                    applyFontBasedOnContent(editor);
                    
                    // Set paper color and style
                    const styleClass = content.style?.split(' ').find(cls => 
                        ['lined', 'grid', 'dots', 'blank'].includes(cls)) || 'lined';
                    changePaperColor(currentPaperColor);
                    changeStyle(styleClass);
                        
                        // Update dropdown states after loading
                        setTimeout(() => {
                            updateDropdownStates();
                        }, 100);
                    
                    showStatus("📂 Your previous masterpiece elegantly restored");
                } catch (error) {
                    console.error("Error loading saved content:", error);
                    showStatus("⚠️ Error loading saved content. Starting fresh.");
                }
                } else {
                    // No saved content, start fresh
                    editor.textContent = '';
                }
            }
        }
        
        // ==================== نظام المسح الذكي ====================
        
        // Smart Clear Function - Works differently for blank mode vs regular papers
        function clearContent() {
            const paper = document.getElementById('notebook-paper');
            const isBlankMode = paper.className.includes('blank-paper-mode');
            
            if (isBlankMode) {
                // In blank mode - clear recordings with confirmation
                clearRecordingContent();
            } else {
                // In regular mode - clear regular content with confirmation
                clearRegularContent();
            }
        }

        // Clear recordings in blank mode
        function clearRecordingContent() {
            // Show confirmation dialog
            const confirmed = confirm("🎙️ Are you sure you want to clear all recordings?\n\nThis will permanently delete all voice transcriptions in blank mode.");
            
            if (confirmed) {
                // Clear the editor
                editor.innerHTML = '';
                
                // Remove from storage
                localStorage.removeItem('blankRecordings');
                
                // Show success message
                showStatus("🗑️ All recordings cleared successfully", 2500);
                
                // If currently recording, stop it
                if (isWhatsAppRecording) {
                    stopWhatsAppRecording();
                    showStatus("🛑 Recording stopped and content cleared", 2500);
                }
                
                // Reset editor focus
                editor.focus();
            }
        }

        // Clear regular content in other paper modes
        function clearRegularContent() {
            // Show confirmation dialog
            const confirmed = confirm("📝 Are you sure you want to clear all content?\n\nThis will permanently delete all text in the current paper.");
            
            if (confirmed) {
                // Clear the editor
                editor.innerHTML = '';
                editor.textContent = '';
                
                // Remove from storage
                localStorage.removeItem('digitalNotebook');
                
                // Show success message
                showStatus("🗑️ Content cleared successfully", 2500);
                
                // Reset word count
                updateWordCount();
                
                // Reset editor focus
                editor.focus();
            }
        }
        
        // ==================== نظام المشاركة الاحترافي ====================
        
        // Share note - Enhanced professional sharing system
        function shareNote() {
            const content = editor.textContent || editor.innerText || '';
            
            // Check if there's content to share
            if (!content.trim()) {
                showStatus("📝 Please write something magnificent before sharing your masterpiece.");
                return;
            }
            
            // Create share modal
            createShareModal(content);
        }
        
        // Create professional share modal
        function createShareModal(content) {
            // Remove existing modal if any
            const existingModal = document.getElementById('shareModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Create modal overlay
            const modalOverlay = document.createElement('div');
            modalOverlay.id = 'shareModal';
            modalOverlay.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            
            // Create modal content
            const modalContent = document.createElement('div');
            modalContent.className = 'bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto';
            
            // Get preview of content (first 100 characters)
            const preview = content.length > 100 ? content.substring(0, 100) + '...' : content;
            
            const encodedContent = encodeURIComponent(content);
            const wordCount = content.split(/\s+/).filter(word => word.length > 0).length;
            
            modalContent.innerHTML = 
                '<div class="bg-gradient-to-r from-blue-600 to-blue-700 p-6 rounded-t-2xl">' +
                    '<div class="flex items-center justify-between">' +
                        '<div class="flex items-center space-x-3">' +
                            '<div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">' +
                                '<i class="fas fa-share-alt text-white text-lg"></i>' +
                            '</div>' +
                                                         '<div>' +
                                 '<h2 class="text-xl font-bold text-white">Share Your Distinguished Masterpiece</h2>' +
                                 '<p class="text-blue-100 text-sm">Select your preferred elegant sharing method</p>' +
                             '</div>' +
                        '</div>' +
                        '<button onclick="closeShareModal()" class="text-white hover:text-blue-200 transition-colors p-2">' +
                            '<i class="fas fa-times text-xl"></i>' +
                        '</button>' +
                    '</div>' +
                '</div>' +
                
                '<div class="p-6">' +
                    '<!-- Content Preview -->' +
                    '<div class="bg-gray-50 rounded-lg p-4 mb-6 border border-gray-200">' +
                                                 '<h3 class="text-sm font-semibold text-gray-600 mb-2 flex items-center">' +
                             '<i class="fas fa-eye text-blue-500 mr-2"></i>' +
                             'Distinguished Content Preview' +
                         '</h3>' +
                        '<p class="text-gray-800 text-sm leading-relaxed" dir="auto">' + preview + '</p>' +
                                                 '<div class="mt-2 text-xs text-gray-500">' +
                             'Distinguished word count: ' + wordCount + ' words' +
                         '</div>' +
                    '</div>' +
                    
                    '<!-- Share Options -->' +
                    '<div class="space-y-4">' +
                        '<!-- Quick Actions -->' +
                        '<div class="grid grid-cols-2 gap-3">' +
                                                         '<button onclick="copyToClipboard(\'' + encodedContent + '\')" ' +
                                     'class="flex items-center justify-center space-x-2 bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-3 rounded-lg hover:from-green-600 hover:to-green-700 transition-all duration-200 transform hover:scale-105 shadow-md">' +
                                 '<i class="fas fa-copy text-sm"></i>' +
                                 '<span class="font-medium text-sm">Elegantly Copy to Clipboard</span>' +
                             '</button>' +
                             
                             '<button onclick="downloadAsFile(\'' + encodedContent + '\')" ' +
                                     'class="flex items-center justify-center space-x-2 bg-gradient-to-r from-purple-500 to-purple-600 text-white px-4 py-3 rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all duration-200 transform hover:scale-105 shadow-md">' +
                                 '<i class="fas fa-download text-sm"></i>' +
                                 '<span class="font-medium text-sm">Download as Distinguished File</span>' +
                             '</button>' +
                        '</div>' +
                        
                        '<!-- Native Share API -->' +
                                                 '<button id="nativeShareBtn" onclick="nativeShare(\'' + encodedContent + '\')" ' +
                                 'class="w-full flex items-center justify-center space-x-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 transform hover:scale-105 shadow-md hidden">' +
                             '<i class="fas fa-mobile-alt text-sm"></i>' +
                             '<span class="font-medium">Native Elegant Share</span>' +
                         '</button>' +
                        
                        '<!-- Social Media Options -->' +
                        '<div class="border-t pt-4">' +
                                                         '<h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center">' +
                                 '<i class="fas fa-hashtag text-blue-500 mr-2"></i>' +
                                 'Share on Distinguished Social Media' +
                             '</h4>' +
                            
                            '<div class="grid grid-cols-2 gap-3">' +
                                                                 '<button onclick="shareToWhatsApp(\'' + encodedContent + '\')" ' +
                                         'class="flex items-center justify-center space-x-2 bg-green-500 text-white px-3 py-2 rounded-lg hover:bg-green-600 transition-colors">' +
                                     '<i class="fab fa-whatsapp text-lg"></i>' +
                                     '<span class="text-sm font-medium">WhatsApp</span>' +
                                 '</button>' +
                                 
                                 '<button onclick="shareToTwitter(\'' + encodedContent + '\')" ' +
                                         'class="flex items-center justify-center space-x-2 bg-blue-400 text-white px-3 py-2 rounded-lg hover:bg-blue-500 transition-colors">' +
                                     '<i class="fab fa-twitter text-lg"></i>' +
                                     '<span class="text-sm font-medium">Twitter</span>' +
                                 '</button>' +
                                 
                                 '<button onclick="shareToTelegram(\'' + encodedContent + '\')" ' +
                                         'class="flex items-center justify-center space-x-2 bg-blue-500 text-white px-3 py-2 rounded-lg hover:bg-blue-600 transition-colors">' +
                                     '<i class="fab fa-telegram text-lg"></i>' +
                                     '<span class="text-sm font-medium">Telegram</span>' +
                                 '</button>' +
                                 
                                 '<button onclick="shareToEmail(\'' + encodedContent + '\')" ' +
                                         'class="flex items-center justify-center space-x-2 bg-gray-600 text-white px-3 py-2 rounded-lg hover:bg-gray-700 transition-colors">' +
                                     '<i class="fas fa-envelope text-lg"></i>' +
                                     '<span class="text-sm font-medium">Email</span>' +
                                 '</button>' +
                            '</div>' +
                        '</div>' +
                        
                        '<!-- Advanced Options -->' +
                        '<div class="border-t pt-4">' +
                                                         '<h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center">' +
                                 '<i class="fas fa-cog text-blue-500 mr-2"></i>' +
                                 'Distinguished Advanced Options' +
                             '</h4>' +
                            
                            '<div class="space-y-2">' +
                                                                 '<button onclick="generateQRCode(\'' + encodedContent + '\')" ' +
                                         'class="w-full flex items-center justify-center space-x-2 bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors border border-gray-300">' +
                                     '<i class="fas fa-qrcode text-sm"></i>' +
                                     '<span class="text-sm font-medium">Generate Distinguished QR Code</span>' +
                                 '</button>' +
                                 
                                 '<button onclick="copyAsHTML(\'' + encodedContent + '\')" ' +
                                         'class="w-full flex items-center justify-center space-x-2 bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors border border-gray-300">' +
                                     '<i class="fas fa-code text-sm"></i>' +
                                     '<span class="text-sm font-medium">Copy as Distinguished HTML</span>' +
                                 '</button>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            
            modalOverlay.appendChild(modalContent);
            document.body.appendChild(modalOverlay);
            
            // Check if native share is available
            if (navigator.share) {
                document.getElementById('nativeShareBtn').classList.remove('hidden');
            }
            
            // Close modal when clicking overlay
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) {
                    closeShareModal();
                }
            });
            
            // Show modal with animation
            setTimeout(() => {
                modalOverlay.style.opacity = '0';
                modalOverlay.style.transform = 'scale(0.95)';
                modalOverlay.style.transition = 'all 0.3s ease-out';
                modalOverlay.style.opacity = '1';
                modalOverlay.style.transform = 'scale(1)';
            }, 10);
        }
        
        // Close share modal
        function closeShareModal() {
            const modal = document.getElementById('shareModal');
            if (modal) {
                modal.style.opacity = '0';
                modal.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }
        
        // Copy to clipboard
        async function copyToClipboard(encodedContent) {
            const content = decodeURIComponent(encodedContent);
            
            try {
                await navigator.clipboard.writeText(content);
                showShareStatus('✅ Content gracefully copied to your clipboard', 'success');
                closeShareModal();
            } catch (err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = content;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    showShareStatus('✅ Content gracefully copied to your clipboard', 'success');
                    closeShareModal();
                } catch (fallbackErr) {
                    showShareStatus('❌ Unable to copy content. Please select and copy manually', 'error');
                }
                
                document.body.removeChild(textArea);
            }
        }
        
        // Download as file - Enhanced memory management and date formatting
        function downloadAsFile(encodedContent) {
            const content = decodeURIComponent(encodedContent);
            const currentDate = new Date();
            
            // Enhanced date formatting with Arabic support
            const dateStr = currentDate.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            }).replace(/\//g, '-');
            const timeStr = currentDate.toTimeString().split(' ')[0].replace(/:/g, '-');
            
            // Determine file extension based on content language
            const isArabic = isArabicText(content);
            const fileName = isArabic ? 
                `مذكرة-${dateStr}-${timeStr}.txt` : 
                `note-${dateStr}-${timeStr}.txt`;
            
            // Create file content with metadata
            const dateAr = currentDate.toLocaleDateString('ar-SA');
            const timeAr = currentDate.toLocaleTimeString('ar-SA');
            const dateEn = currentDate.toLocaleDateString('en-US');
            const timeEn = currentDate.toLocaleTimeString('en-US');
            
            const fileContent = 'Script.ai - Distinguished Digital Workspace Note\n' +
                'Elegantly Created: ' + dateEn + ' at ' + timeEn + '\n' +
                '═══════════════════════════════════════════════════════════════\n\n' +
                content + '\n\n' +
                '═══════════════════════════════════════════════════════════════\n' +
                'Distinguishedly crafted with Script.ai - Intelligent Writing Companion\n' +
                'Experience the distinguished future of writing at:\n' +
                'https://moibrahim0115.github.io/Script/';
            
            // Create and trigger download
            const blob = new Blob([fileContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            
            link.href = url;
            link.download = fileName;
            link.style.display = 'none';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Enhanced memory cleanup with proper timing
            setTimeout(() => {
                URL.revokeObjectURL(url);
            }, 100);
            
            showShareStatus('📁 File downloaded successfully to your device', 'success');
            closeShareModal();
        }
        
        // Native share API
        async function nativeShare(encodedContent) {
            const content = decodeURIComponent(encodedContent);
            
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Shared from Script.ai',
                        text: content,
                        url: window.location.href
                    });
                    
                    showShareStatus('✅ Content shared successfully', 'success');
                    closeShareModal();
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        showShareStatus('❌ Sharing failed', 'error');
                    }
                }
            } else {
                showShareStatus('❌ Native sharing not available in this browser', 'error');
            }
        }
        
        // Share to WhatsApp
        function shareToWhatsApp(encodedContent) {
            const content = decodeURIComponent(encodedContent);
            const currentUrl = window.location.href;
            const message = '📝 Distinguished content shared from Script.ai:\n\n' + content + '\n\n✨ Distinguishedly created using: ' + currentUrl;
            const whatsappUrl = 'https://wa.me/?text=' + encodeURIComponent(message);
            
            window.open(whatsappUrl, '_blank');
            showShareStatus('📱 Opening WhatsApp for sharing', 'info');
            closeShareModal();
        }
        
        // Share to Twitter
        function shareToTwitter(encodedContent) {
            const content = decodeURIComponent(encodedContent);
            const tweet = content.length > 200 ? content.substring(0, 200) + '...' : content;
            const currentUrl = window.location.href;
            const twitterUrl = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(tweet) + '&url=' + encodeURIComponent(currentUrl) + '&hashtags=ScriptAI,DistinguishedWriting';
            
            window.open(twitterUrl, '_blank');
            showShareStatus('🐦 Opening Twitter for sharing', 'info');
            closeShareModal();
        }
        
        // Share to Telegram
        function shareToTelegram(encodedContent) {
            const content = decodeURIComponent(encodedContent);
            const currentUrl = window.location.href;
            const message = '📝 Distinguished content shared from Script.ai:\n\n' + content + '\n\n✨ Distinguishedly shared via: ' + currentUrl;
            const telegramUrl = 'https://t.me/share/url?url=' + encodeURIComponent(currentUrl) + '&text=' + encodeURIComponent(message);
            
            window.open(telegramUrl, '_blank');
            showShareStatus('✈️ Opening Telegram for sharing', 'info');
            closeShareModal();
        }
        
        // Share to Email
        function shareToEmail(encodedContent) {
            const content = decodeURIComponent(encodedContent);
            const subject = 'Distinguished Note Shared from Script.ai';
            const currentUrl = window.location.href;
            
            const body = 'Hello,\n\n' +
                'I would like to share this distinguished note with you:\n\n' +
                content + '\n\n' +
                '═══════════════════════════════════════\n' +
                'Elegantly created using Script.ai - Intelligent Writing Tool\n' +
                currentUrl + '\n\n' +
                'Best regards';
            
            const emailUrl = 'mailto:?subject=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(body);
            window.location.href = emailUrl;
            
            showShareStatus('📧 Opening email client for sharing', 'info');
            closeShareModal();
        }
        
        // Generate QR Code
        function generateQRCode(encodedContent) {
            const content = decodeURIComponent(encodedContent);
            // Using QR Server API for QR code generation
            const qrData = encodeURIComponent(content);
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${qrData}`;
            
            // Create QR modal
            const qrModal = document.createElement('div');
            qrModal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            qrModal.innerHTML = 
                '<div class="bg-white rounded-2xl p-6 max-w-sm w-full text-center">' +
                    '<h3 class="text-lg font-bold mb-4 text-gray-800">Distinguished QR Code for Your Content</h3>' +
                    '<div class="bg-gray-100 p-4 rounded-lg mb-4">' +
                        '<img src="' + qrUrl + '" alt="QR Code" class="mx-auto" style="max-width: 250px;">' +
                    '</div>' +
                    '<p class="text-sm text-gray-600 mb-4">Gracefully scan the code to view your distinguished content</p>' +
                    '<button onclick="this.parentElement.parentElement.remove()" ' +
                            'class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">' +
                        'Close' +
                    '</button>' +
                '</div>';
            
            document.body.appendChild(qrModal);
            
            // Close QR modal when clicking overlay
            qrModal.addEventListener('click', (e) => {
                if (e.target === qrModal) {
                    qrModal.remove();
                }
            });
            
            showShareStatus('📱 QR code generated successfully', 'success');
        }
        
        // Copy as HTML
        async function copyAsHTML(encodedContent) {
            const content = decodeURIComponent(encodedContent);
            const currentDate = new Date();
            const dateStr = currentDate.toLocaleDateString('en-US');
            const timeStr = currentDate.toLocaleTimeString('en-US');
            const currentUrl = window.location.href;
            
            const htmlContent = 
                '<!DOCTYPE html>\n' +
                '<html lang="en" dir="auto">\n' +
                '<head>\n' +
                '    <meta charset="UTF-8">\n' +
                '    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n' +
                '    <title>Note from Script.ai</title>\n' +
                '    <style>\n' +
                '        body { \n' +
                '            font-family: \'Amiri\', \'Scheherazade New\', \'Patrick Hand\', serif; \n' +
                '            line-height: 1.8; \n' +
                '            max-width: 800px; \n' +
                '            margin: 0 auto; \n' +
                '            padding: 2rem; \n' +
                '            background: #f8f9fa;\n' +
                '        }\n' +
                '        .content { \n' +
                '            background: white; \n' +
                '            padding: 2rem; \n' +
                '            border-radius: 12px; \n' +
                '            box-shadow: 0 4px 6px rgba(0,0,0,0.1); \n' +
                '            white-space: pre-wrap;\n' +
                '        }\n' +
                '        .header { \n' +
                '            text-align: center; \n' +
                '            margin-bottom: 2rem; \n' +
                '            color: #1e40af; \n' +
                '            border-bottom: 2px solid #e5e7eb; \n' +
                '            padding-bottom: 1rem; \n' +
                '        }\n' +
                '    </style>\n' +
                '</head>\n' +
                '<body>\n' +
                '    <div class="header">\n' +
                '        <h1>📝 Distinguished Note from Script.ai</h1>\n' +
                '        <p>Elegantly created on: ' + dateStr + ' - ' + timeStr + '</p>\n' +
                '    </div>\n' +
                '    <div class="content">' + content + '</div>\n' +
                '    <footer style="text-align: center; margin-top: 2rem; color: #6b7280; font-size: 0.9rem;">\n' +
                '        ✨ Distinguishedly crafted with <a href="' + currentUrl + '" style="color: #3b82f6;">Script.ai</a>\n' +
                '    </footer>\n' +
                '</body>\n' +
                '</html>';
            
            try {
                await navigator.clipboard.writeText(htmlContent);
                showShareStatus('✅ HTML code elegantly copied to clipboard', 'success');
                closeShareModal();
            } catch (err) {
                showShareStatus('❌ Failed to copy HTML code', 'error');
            }
        }
        
        // Show share status message
        function showShareStatus(message, type = 'info') {
            const colors = {
                success: { bg: '#ecfdf5', border: '#10b981', text: '#065f46' },
                error: { bg: '#fef2f2', border: '#ef4444', text: '#991b1b' },
                info: { bg: '#eff6ff', border: '#3b82f6', text: '#1e40af' }
            };
            
            const color = colors[type] || colors.info;
            
            statusDiv.innerHTML = message;
            statusDiv.style.opacity = 1;
            statusDiv.style.transform = 'translateY(0)';
            statusDiv.style.backgroundColor = color.bg;
            statusDiv.style.border = `1px solid ${color.border}`;
            statusDiv.style.color = color.text;
            statusDiv.style.maxWidth = '500px';
            statusDiv.style.margin = '1rem auto';
            statusDiv.style.padding = '1rem';
            
            setTimeout(() => {
                statusDiv.style.opacity = 0;
                statusDiv.style.transform = 'translateY(20px)';
            }, 3000);
        }
        
        // Show permission help
        function showPermissionHelp() {
            const helpHTML = 
                '<div style="text-align: left; direction: ltr; line-height: 1.8;">' +
                    '<h4 style="color: #dc2626; margin-bottom: 1rem; font-weight: 600;">🎤 Microphone Access Permission Guidance</h4>' +
                    '<div style="background: #f9fafb; padding: 1.2rem; border-radius: 12px; margin-bottom: 1rem; border-left: 4px solid #3b82f6;">' +
                        '<h5 style="margin-bottom: 0.8rem; color: #1f2937; font-weight: 500;">Elegant Steps to Grant Permission:</h5>' +
                        '<ol style="margin-left: 1.5rem; margin-bottom: 0; color: #374151;">' +
                            '<li style="margin-bottom: 0.4rem;">Locate the security icon 🔒 or microphone symbol 🎤 in your browser\'s address bar</li>' +
                            '<li style="margin-bottom: 0.4rem;">Click the icon and select "Allow" from the distinguished options</li>' +
                            '<li style="margin-bottom: 0.4rem;">If no prompt appears, refresh the page (F5) to reinitiate the permission request</li>' +
                            '<li style="margin-bottom: 0.4rem;">Gracefully retry the voice button to commence your audio experience</li>' +
                        '</ol>' +
                    '</div>' +
                    '<p style="font-size: 0.9rem; color: #6b7280; font-style: italic;">' +
                        '💡 Alternatively, navigate to your browser\'s settings to manually configure site permissions for this distinguished workspace' +
                    '</p>' +
                '</div>';
            
            statusDiv.innerHTML = helpHTML;
            statusDiv.style.opacity = 1;
            statusDiv.style.transform = 'translateY(0)';
            statusDiv.style.backgroundColor = '#fef3c7';
            statusDiv.style.border = '1px solid #f59e0b';
            statusDiv.style.maxWidth = '600px';
            statusDiv.style.margin = '1rem auto';
            statusDiv.style.padding = '1.5rem';
            
            // Auto-hide after 8 seconds
            setTimeout(() => {
                statusDiv.style.opacity = 0;
                statusDiv.style.transform = 'translateY(20px)';
            }, 8000);
        }

        // Show browser compatibility info
        function showBrowserInfo() {
            const infoHTML = 
                '<div style="text-align: center; direction: ltr; line-height: 1.8;">' +
                    '<h4 style="color: #dc2626; margin-bottom: 1rem; font-weight: 600;">🎤 Voice Recognition Support</h4>' +
                    '<p style="margin-bottom: 1rem; color: #374151;">Voice recognition is not supported in this distinguished browser.</p>' +
                    '<div style="background: #f3f4f6; padding: 1.2rem; border-radius: 12px; margin-bottom: 1rem;">' +
                        '<h5 style="margin-bottom: 0.8rem; color: #065f46; font-weight: 600;">💡 Supported Browsers:</h5>' +
                        '<ul style="margin: 0; color: #374151; text-align: left;">' +
                            '<li>✅ Google Chrome</li>' +
                            '<li>✅ Microsoft Edge</li>' +
                            '<li>✅ Safari (iOS/macOS)</li>' +
                            '<li>❌ Firefox (Limited Support)</li>' +
                        '</ul>' +
                    '</div>' +
                    '<p style="font-size: 0.9rem; color: #6b7280; font-style: italic;">' +
                        'You can use the text editor naturally — only voice input is affected' +
                    '</p>' +
                '</div>';
            
            statusDiv.innerHTML = infoHTML;
            statusDiv.style.opacity = 1;
            statusDiv.style.transform = 'translateY(0)';
            statusDiv.style.backgroundColor = '#fef2f2';
            statusDiv.style.border = '1px solid #fecaca';
            statusDiv.style.maxWidth = '500px';
            statusDiv.style.margin = '1rem auto';
            statusDiv.style.padding = '1.5rem';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                statusDiv.style.opacity = 0;
                statusDiv.style.transform = 'translateY(20px)';
            }, 5000);
        }

        // Show status message
        function showStatus(message, duration = 3000) {
            statusDiv.innerHTML = message; // Changed to innerHTML to support HTML content
            statusDiv.style.opacity = 1;
            statusDiv.style.transform = 'translateY(0)';
            statusDiv.style.backgroundColor = '#f0f9ff';
            statusDiv.style.border = '1px solid #e0e7ff';
            statusDiv.style.maxWidth = '500px';
            statusDiv.style.margin = '1rem auto';
            statusDiv.style.padding = '1rem';
            statusDiv.style.textAlign = 'center';
            statusDiv.style.direction = 'auto';
            
            if (duration) {
                setTimeout(() => {
                    statusDiv.style.opacity = 0;
                    statusDiv.style.transform = 'translateY(20px)';
                }, duration);
            }
        }

        // Typing sound disabled as requested
        function playTypingSound() {
            // Sound disabled - no audio feedback
            return;
        }
        
        // Enhanced performance optimization: Debounce function with error handling
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    try {
                        func(...args);
                    } catch (error) {
                        console.error("Debounced function error:", error);
                    }
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Enhanced console helper for developers with detailed diagnostics
        function logDeveloperTips() {
            const isSupported = ('webkitSpeechRecognition' in window) || ('SpeechRecognition' in window);
            const isSecure = window.isSecureContext;
            const userAgent = navigator.userAgent;
            
            console.log('%c🎤 Script.ai - Enhanced Diagnostics', 'font-size: 16px; font-weight: bold; color: #2563eb;');
            console.log('Speech Recognition Support:', isSupported ? '✅' : '❌');
            console.log('Secure Context (HTTPS):', isSecure ? '✅' : '❌');
            console.log('Performance Optimizations: ✅ Enabled');
            console.log('Security Enhancements: ✅ Enabled');
            console.log('Accessibility Features: ✅ Enhanced');
            console.log('GitHub Pages Ready: ✅ Optimized');
            console.log('Voice Recording System: ✅ Enhanced');
            
            if (isSupported) {
                console.log('%c✨ Voice recognition system ready for Arabic and English!', 'color: #10b981; font-weight: bold;');
                console.log('🎯 Supports: Chrome, Edge, Safari');
                console.log('🔄 Automatic language detection enabled');
                console.log('🔒 Secure context required for voice features');
                console.log('📱 Mobile optimizations enabled');
            } else {
                console.log('%c⚠️ Voice recognition not supported in this browser', 'color: #f59e0b; font-weight: bold;');
                console.log('💡 Try using Chrome, Edge, or Safari for voice features');
                if (!isSecure) {
                    console.log('🔒 HTTPS required for voice recognition');
                }
            }
            
            // Performance metrics
            console.log('%c📊 Performance Metrics', 'font-size: 14px; font-weight: bold; color: #7c3aed;');
            console.log('Font Loading:', document.fonts.status === 'loaded' ? '✅ Complete' : '⏳ Loading');
            console.log('DOM Readiness:', document.readyState === 'complete' ? '✅ Complete' : '⏳ Loading');
        }

        // Keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + S to save
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    saveNote();
                }
            });
        }

        // Update date and time display with enhanced localization and performance
        function updateDateTime() {
            const now = new Date();
            
            // Enhanced date formatting with English support and better performance
            const dateTimeString = now.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            }) + ' - ' + now.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
            
            // Use cached element reference for better performance
            if (dateTimeElement) {
                dateTimeElement.textContent = dateTimeString;
            }
        }

        // Update footer year
        function updateFooterYear() {
            const currentYear = new Date().getFullYear();
            const yearElement = document.getElementById('year');
            if (yearElement) {
                yearElement.textContent = currentYear;
            }
        }

        // Mobile dropdown functionality
        function setupMobileDropdowns() {
            // Tools dropdown
            const toolsBtn = document.getElementById('mobileToolsBtn');
            const toolsDropdown = document.getElementById('mobileToolsDropdown');
            
            // Close dropdown
            function closeDropdown() {
                if (toolsDropdown) toolsDropdown.classList.add('hidden');
            }
            
            // Tools button click
            if (toolsBtn && toolsDropdown) {
                toolsBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toolsDropdown.classList.toggle('hidden');
                });
            }
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!toolsBtn?.contains(e.target) && !toolsDropdown?.contains(e.target)) {
                    closeDropdown();
                }
            });
            
            // Update format buttons active state within the dropdown
            updateMobileFormatButtons();
        }

        // Update mobile format buttons active state
        function updateMobileFormatButtons() {
            const toolsDropdown = document.getElementById('mobileToolsDropdown');
            const formatButtons = toolsDropdown?.querySelectorAll('[onclick^="changeStyle"]');
            
            if (formatButtons) {
                formatButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        // Reset all format buttons to their original colors
                        formatButtons.forEach(b => {
                            if (b.getAttribute('onclick').includes("'lined'")) {
                                b.className = 'group px-3 py-2 bg-gradient-to-br from-slate-600 to-slate-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105';
                            } else if (b.getAttribute('onclick').includes("'grid'")) {
                                b.className = 'group px-3 py-2 bg-gradient-to-br from-slate-600 to-slate-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105';
                            } else if (b.getAttribute('onclick').includes("'dots'")) {
                                b.className = 'group px-3 py-2 bg-gradient-to-br from-indigo-600 to-indigo-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105';
                            } else if (b.getAttribute('onclick').includes("'blank'")) {
                                b.className = 'group px-3 py-2 bg-gradient-to-br from-purple-600 to-purple-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105';
                            }
                        });
                        
                        // Activate clicked button with blue gradient
                        btn.className = 'group px-3 py-2 bg-gradient-to-br from-blue-600 to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105';
                        
                        // Close dropdown after selection
                        setTimeout(() => {
                            const toolsDropdown = document.getElementById('mobileToolsDropdown');
                            if (toolsDropdown) toolsDropdown.classList.add('hidden');
                        }, 300);
                    });
                });
            }
        }

        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', () => {
            init();
            setupKeyboardShortcuts();
            setupMobileDropdowns();
            logDeveloperTips();
            logPerformanceMetrics();
            
            // Initialize and update date/time
            updateDateTime();
            setInterval(updateDateTime, 1000); // Update every second
            
            // Update footer year
            updateFooterYear();
            
            // Future PWA enhancement: Register service worker
            // if ('serviceWorker' in navigator) {
            //     navigator.serviceWorker.register('/sw.js');
            // }
        });

        // Enhanced global error handler for better debugging and security
        window.addEventListener('error', (e) => {
            console.error('Script Error:', e.error);
            console.error('Error Details:', {
                message: e.message,
                filename: e.filename,
                lineno: e.lineno,
                colno: e.colno
            });
            
            // Only show user-friendly message for non-critical errors
            if (!e.error || e.error.name !== 'SecurityError') {
                showStatus('⚠️ An unexpected circumstance occurred. Please refresh the page if the issue persists.');
            }
        });

        // Enhanced unhandled promise rejection handler
        window.addEventListener('unhandledrejection', (e) => {
            console.error('Unhandled Promise Rejection:', e.reason);
            console.error('Promise Details:', {
                reason: e.reason,
                promise: e.promise
            });
            e.preventDefault();
        });

        // Performance monitoring
        function logPerformanceMetrics() {
            if ('performance' in window) {
                const perfData = performance.getEntriesByType('navigation')[0];
                            console.log('%c📊 Performance Metrics', 'font-size: 14px; font-weight: bold; color: #7c3aed;');
            console.log('Page Load Time:', Math.round(perfData.loadEventEnd - perfData.loadEventStart), 'milliseconds');
            console.log('DOM Content Load:', Math.round(perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart), 'milliseconds');
            console.log('First Paint:', Math.round(perfData.responseEnd - perfData.fetchStart), 'milliseconds');
            }
        }

        window.addEventListener('DOMContentLoaded', function() {
          var bg = document.getElementById('bg-animated-dots-lines');
          if (bg) {
            bg.innerHTML = `
            <svg width="100vw" height="100vh" viewBox="0 0 1440 900" fill="none" xmlns="http://www.w3.org/2000/svg">
              <!-- Lines -->
              <line x1="100" y1="120" x2="1340" y2="120" class="animated-line" />
              <line x1="200" y1="300" x2="1240" y2="400" class="animated-line2" />
              <line x1="300" y1="700" x2="1100" y2="200" class="animated-line" />
              <line x1="400" y1="500" x2="900" y2="800" class="animated-line2" />
              <line x1="100" y1="800" x2="1340" y2="850" class="animated-line" />
              <!-- Dots -->
              <circle cx="200" cy="150" r="10" class="animated-dot" />
              <circle cx="600" cy="300" r="7" class="animated-dot2" />
              <circle cx="1200" cy="200" r="8" class="animated-dot" />
              <circle cx="900" cy="700" r="12" class="animated-dot2" />
              <circle cx="400" cy="800" r="9" class="animated-dot" />
              <circle cx="1100" cy="500" r="6" class="animated-dot2" />
            </svg>
            `;
          }
        });
    </script>
</body>
</html>
